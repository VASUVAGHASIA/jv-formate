[{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\commands\\commands.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\commands\\functions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\ApiKeyInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\AutoFormatModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\ChatWindow.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5260,5263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5260,5263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6831,6834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6831,6834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":346,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":346,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11062,11065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11062,11065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":419,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":419,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14621,14624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14621,14624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* global Word */\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { generateActionableContent, listModels, type AttachedFile as GeminiAttachedFile } from '../utils/gemini';\r\nimport { parseMarkdownToHtml } from '../utils/markdownParser';\r\nimport {\r\n  replaceSelectedTextWithHtml,\r\n  getSelectedText,\r\n  formatSelection,\r\n  formatDocument,\r\n  getDocumentStats,\r\n  getFullDocumentText,\r\n  fixAllHeadings,\r\n  normalizeDocumentFonts,\r\n  setDocumentMargins,\r\n  centerAllImages,\r\n  updateAllHeaders,\r\n  updateAllFooters,\r\n  applyBulletList,\r\n  applyNumberedList,\r\n  clearFormatting,\r\n  autoFormatDocument,\r\n  addBorderToSelection,\r\n  addPageBorder,\r\n  addBorderToParagraphs,\r\n  removeBorders,\r\n  addDecorativeBorder\r\n} from '../utils/wordUtils';\r\n\r\ntype AttachedFile = GeminiAttachedFile;\r\n\r\ninterface Message {\r\n  id: string;\r\n  role: 'user' | 'assistant';\r\n  content: string;\r\n  timestamp: Date;\r\n  actionPerformed?: string;\r\n  addedToDoc?: boolean;\r\n  insertedRangeId?: string;\r\n  payload?: string;\r\n  attachedFiles?: AttachedFile[];\r\n  formatting?: {\r\n    bold?: boolean;\r\n    italic?: boolean;\r\n    underline?: boolean;\r\n    fontName?: string;\r\n    fontSize?: number;\r\n    color?: string;\r\n    alignment?: 'left' | 'center' | 'right' | 'justify';\r\n    lineSpacing?: number;\r\n    spaceAfter?: number;\r\n    spaceBefore?: number;\r\n  };\r\n}\r\n\r\ntype ChatMode = 'ask' | 'edit';\r\n\r\nexport type GeminiModel =\r\n  | 'gemini-2.0-flash-exp'\r\n  | 'gemini-2.0-flash-lite'\r\n  | 'gemini-1.5-flash'\r\n  | 'gemini-1.5-flash-8b'\r\n  | 'gemini-1.5-pro';\r\n\r\nconst ChatWindow: React.FC = () => {\r\n  const [chatMode, setChatMode] = useState<ChatMode>('ask');\r\n  const [selectedModel, setSelectedModel] = useState<GeminiModel>('gemini-2.0-flash-lite');\r\n  const [availableModels, setAvailableModels] = useState<string[]>([]);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [canReadDocument, setCanReadDocument] = useState(false);\r\n  const [attachedFiles, setAttachedFiles] = useState<AttachedFile[]>([]);\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  useEffect(() => {\r\n    // Fetch available models on component mount\r\n    const fetchModels = async () => {\r\n      try {\r\n        const models = await listModels();\r\n        setAvailableModels(models);\r\n      } catch (error) {\r\n        console.error('Failed to fetch models:', error);\r\n      }\r\n    };\r\n    fetchModels();\r\n  }, []);\r\n\r\n  const handleCopy = (content: string) => {\r\n    navigator.clipboard.writeText(content);\r\n  };\r\n\r\n  const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = event.target.files;\r\n    if (!files) return;\r\n\r\n    Array.from(files).forEach((file) => {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        const content = e.target?.result as string;\r\n        const attachedFile: AttachedFile = {\r\n          name: file.name,\r\n          size: file.size,\r\n          type: file.type || 'application/octet-stream',\r\n          content: content.split(',')[1] || content, // Remove data URL prefix\r\n        };\r\n        setAttachedFiles((prev) => [...prev, attachedFile]);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    });\r\n\r\n    // Reset input\r\n    if (event.target) {\r\n      event.target.value = '';\r\n    }\r\n  };\r\n\r\n  const handleRemoveFile = (index: number) => {\r\n    setAttachedFiles((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleAttachClick = () => {\r\n    fileInputRef.current?.click();\r\n  };\r\n\r\n  const handleDragEnter = (e: React.DragEvent<HTMLTextAreaElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragging(true);\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent<HTMLTextAreaElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragging(false);\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent<HTMLTextAreaElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent<HTMLTextAreaElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragging(false);\r\n\r\n    const files = e.dataTransfer.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    Array.from(files).forEach((file) => {\r\n      const reader = new FileReader();\r\n      reader.onload = (event) => {\r\n        const content = event.target?.result as string;\r\n        const attachedFile: AttachedFile = {\r\n          name: file.name,\r\n          size: file.size,\r\n          type: file.type || 'application/octet-stream',\r\n          content: content.split(',')[1] || content, // Remove data URL prefix\r\n        };\r\n        setAttachedFiles((prev) => [...prev, attachedFile]);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    });\r\n  };\r\n\r\n  const handleAddToDoc = async (messageId: string, content: string, formatting?: any) => {\r\n    try {\r\n      const htmlContent = parseMarkdownToHtml(content);\r\n\r\n      // Insert and track the range\r\n      await Word.run(async (context) => {\r\n        const range = context.document.getSelection();\r\n        const insertedRange = range.insertHtml(htmlContent, Word.InsertLocation.end);\r\n\r\n        // Apply formatting if present\r\n        if (formatting) {\r\n          if (formatting.fontName) insertedRange.font.name = formatting.fontName;\r\n\r\n          if (formatting.fontSize) {\r\n            const size = parseFloat(formatting.fontSize);\r\n            if (!isNaN(size) && size > 0) {\r\n              insertedRange.font.size = size;\r\n            }\r\n          }\r\n\r\n          if (formatting.bold !== undefined) insertedRange.font.bold = formatting.bold;\r\n          if (formatting.italic !== undefined) insertedRange.font.italic = formatting.italic;\r\n          if (formatting.color) insertedRange.font.color = formatting.color;\r\n\r\n          if (formatting.alignment) {\r\n            // We need to sync to load paragraphs for alignment\r\n            insertedRange.paragraphs.load('items');\r\n            await context.sync();\r\n\r\n            const alignMap: Record<string, Word.Alignment> = {\r\n              'left': Word.Alignment.left,\r\n              'center': Word.Alignment.centered,\r\n              'right': Word.Alignment.right,\r\n              'justify': Word.Alignment.justified\r\n            };\r\n\r\n            const mappedAlignment = alignMap[formatting.alignment.toLowerCase()] || Word.Alignment.left;\r\n\r\n            insertedRange.paragraphs.items.forEach((p: any) => {\r\n              p.alignment = mappedAlignment;\r\n            });\r\n          }\r\n        }\r\n\r\n        // Sync formatting before creating content control\r\n        await context.sync();\r\n\r\n        // Track the range using a unique ID\r\n        const rangeId = `inserted-${messageId}-${Date.now()}`;\r\n\r\n        // Wrap in a try-catch specifically for content control creation as it can be finicky\r\n        try {\r\n          const cc = insertedRange.insertContentControl();\r\n          cc.tag = rangeId;\r\n          cc.appearance = Word.ContentControlAppearance.hidden;\r\n\r\n          // Sync to ensure the CC is created\r\n          await context.sync();\r\n\r\n          // Update message state only if successful\r\n          setMessages(prev => prev.map(msg =>\r\n            msg.id === messageId\r\n              ? { ...msg, addedToDoc: true, insertedRangeId: rangeId }\r\n              : msg\r\n          ));\r\n        } catch (ccError) {\r\n          console.warn(\"Failed to create content control, but content was inserted:\", ccError);\r\n          // Still mark as added, but maybe without the range ID for undo? \r\n          // Or just fail gracefully. For now, we'll mark it added so user knows.\r\n          setMessages(prev => prev.map(msg =>\r\n            msg.id === messageId\r\n              ? { ...msg, addedToDoc: true } // No rangeId means undo might not work, but content is there\r\n              : msg\r\n          ));\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to add to doc:', error);\r\n    }\r\n  };\r\n\r\n  const handleUndoAddToDoc = async (messageId: string, rangeId: string) => {\r\n    try {\r\n      await Word.run(async (context) => {\r\n        const contentControls = context.document.contentControls;\r\n        contentControls.load('items');\r\n        await context.sync();\r\n\r\n        // Find and delete the content control with the matching tag\r\n        for (const cc of contentControls.items) {\r\n          cc.load('tag');\r\n        }\r\n        await context.sync();\r\n\r\n        for (const cc of contentControls.items) {\r\n          if (cc.tag === rangeId) {\r\n            cc.delete(false); // false = delete both the content control and its content\r\n            break;\r\n          }\r\n        }\r\n\r\n        await context.sync();\r\n\r\n        // Update message state\r\n        setMessages(prev => prev.map(msg =>\r\n          msg.id === messageId\r\n            ? { ...msg, addedToDoc: false, insertedRangeId: undefined }\r\n            : msg\r\n        ));\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to undo add to doc:', error);\r\n    }\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (!input.trim() || isLoading) return;\r\n\r\n    const userMessage: Message = {\r\n      id: Date.now().toString(),\r\n      role: 'user',\r\n      content: input,\r\n      timestamp: new Date(),\r\n      attachedFiles: attachedFiles.length > 0 ? [...attachedFiles] : undefined,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, userMessage]);\r\n    setInput('');\r\n    setAttachedFiles([]);\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      // 1. Get Context (Selection or Document)\r\n      let contextText = '';\r\n      let hasSelection = false;\r\n\r\n      try {\r\n        const selection = await getSelectedText();\r\n        if (selection && selection.trim().length > 0) {\r\n          contextText = selection;\r\n          hasSelection = true;\r\n        } else if (canReadDocument) {\r\n          // If toggle is enabled, read full document\r\n          const fullText = await getFullDocumentText();\r\n          if (fullText && fullText.trim().length > 0) {\r\n            contextText = fullText;\r\n          }\r\n        } else {\r\n          const stats = await getDocumentStats();\r\n          if (stats.characterCount > 0) {\r\n            contextText = \"Entire document context (content not fully loaded for performance).\";\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn(\"Failed to get context:\", e);\r\n      }\r\n\r\n      // 2. Call AI\r\n      const response = await generateActionableContent(\r\n        input,\r\n        contextText,\r\n        hasSelection,\r\n        selectedModel,\r\n        userMessage.attachedFiles\r\n      );\r\n\r\n      // 3. Execute Action\r\n      let actionPerformed = '';\r\n      let payload: string | undefined;\r\n      let formatting: any | undefined;\r\n\r\n      if (response.action) {\r\n        const action = response.action;\r\n\r\n        // Capture formatting if present\r\n        if (action.formatting) {\r\n          formatting = action.formatting;\r\n        }\r\n\r\n        // In 'ask' mode, intercept ALL actions - no document modifications allowed\r\n        // Only the \"Add to doc\" button should modify the document\r\n        if (chatMode === 'ask') {\r\n          // Store content as payload for display and manual insertion via \"Add to doc\" button\r\n          if (action.content) {\r\n            payload = action.content;\r\n            actionPerformed = 'Content ready - click \"Add to doc\" to insert';\r\n          }\r\n          // Skip action execution entirely in ask mode\r\n        } else {\r\n          try {\r\n            if (action.type === 'format' && action.formatting) {\r\n              if (action.target === 'document') {\r\n                await formatDocument(action.formatting);\r\n                actionPerformed = 'Formatted document';\r\n              } else {\r\n                await formatSelection(action.formatting);\r\n                actionPerformed = 'Formatted selection';\r\n              }\r\n            } else if (action.type === 'replace' && action.content) {\r\n              // Parse Markdown to HTML for rich text replacement\r\n              const htmlContent = parseMarkdownToHtml(action.content);\r\n              await replaceSelectedTextWithHtml(htmlContent);\r\n              // Apply formatting if present\r\n              if (formatting) {\r\n                await formatSelection(formatting);\r\n              }\r\n              actionPerformed = 'Replaced text';\r\n            } else if (action.type === 'insert' && action.content) {\r\n              // Parse Markdown to HTML for rich text insertion\r\n              const htmlContent = parseMarkdownToHtml(action.content);\r\n              // We use insertHtmlAtCursor but we need to apply formatting.\r\n              await Word.run(async (context) => {\r\n                const range = context.document.getSelection();\r\n                const insertedRange = range.insertHtml(htmlContent, Word.InsertLocation.end);\r\n\r\n                if (formatting) {\r\n                  // Sanitize and apply formatting\r\n                  if (formatting.fontName) insertedRange.font.name = formatting.fontName;\r\n\r\n                  if (formatting.fontSize) {\r\n                    const size = parseFloat(formatting.fontSize);\r\n                    if (!isNaN(size) && size > 0) {\r\n                      insertedRange.font.size = size;\r\n                    }\r\n                  }\r\n\r\n                  if (formatting.bold !== undefined) insertedRange.font.bold = formatting.bold;\r\n                  if (formatting.italic !== undefined) insertedRange.font.italic = formatting.italic;\r\n                  if (formatting.color) insertedRange.font.color = formatting.color;\r\n\r\n                  // Load paragraphs for alignment and spacing\r\n                  insertedRange.paragraphs.load('items');\r\n                  await context.sync();\r\n\r\n                  if (formatting.alignment || formatting.lineSpacing || formatting.spaceAfter !== undefined || formatting.spaceBefore !== undefined) {\r\n                    const alignMap: Record<string, Word.Alignment> = {\r\n                      'left': Word.Alignment.left,\r\n                      'center': Word.Alignment.centered,\r\n                      'right': Word.Alignment.right,\r\n                      'justify': Word.Alignment.justified\r\n                    };\r\n\r\n                    insertedRange.paragraphs.items.forEach((p: any) => {\r\n                      if (formatting.alignment) {\r\n                        const mappedAlignment = alignMap[formatting.alignment.toLowerCase()] || Word.Alignment.left;\r\n                        p.alignment = mappedAlignment;\r\n                      }\r\n                      if (formatting.lineSpacing) {\r\n                        p.lineSpacing = formatting.lineSpacing;\r\n                      }\r\n                      if (formatting.spaceAfter !== undefined) {\r\n                        p.spaceAfter = formatting.spaceAfter;\r\n                      }\r\n                      if (formatting.spaceBefore !== undefined) {\r\n                        p.spaceBefore = formatting.spaceBefore;\r\n                      }\r\n                    });\r\n                  }\r\n                }\r\n                await context.sync();\r\n              });\r\n              actionPerformed = 'Inserted text';\r\n            } else if (action.type === 'command' && action.commandName) {\r\n              switch (action.commandName) {\r\n                case 'fixHeadings':\r\n                  await fixAllHeadings();\r\n                  actionPerformed = 'Fixed headings';\r\n                  break;\r\n                case 'normalizeFonts':\r\n                  await normalizeDocumentFonts(action.args?.fontName, action.args?.fontSize);\r\n                  actionPerformed = 'Normalized fonts';\r\n                  break;\r\n                case 'setMargins':\r\n                  await setDocumentMargins(action.args);\r\n                  actionPerformed = 'Set margins';\r\n                  break;\r\n                case 'formatImages':\r\n                  await centerAllImages(action.args?.padding, action.args?.addCaptions, action.args?.alignment);\r\n                  actionPerformed = 'Formatted images';\r\n                  break;\r\n                case 'updateHeader':\r\n                  await updateAllHeaders(action.args?.leftText || '', action.args?.rightText || '');\r\n                  actionPerformed = 'Updated headers';\r\n                  break;\r\n                case 'updateFooter':\r\n                  await updateAllFooters(\r\n                    action.args?.leftText || '',\r\n                    action.args?.centerText || '',\r\n                    action.args?.rightText || '',\r\n                    action.args?.addPageNumbers || false\r\n                  );\r\n                  actionPerformed = 'Updated footers';\r\n                  break;\r\n                case 'applyBulletList':\r\n                  await applyBulletList();\r\n                  actionPerformed = 'Applied bullet list';\r\n                  break;\r\n                case 'applyNumberedList':\r\n                  await applyNumberedList();\r\n                  actionPerformed = 'Applied numbered list';\r\n                  break;\r\n                case 'clearFormatting':\r\n                  await clearFormatting();\r\n                  actionPerformed = 'Cleared formatting';\r\n                  break;\r\n                case 'autoFormat':\r\n                  await autoFormatDocument();\r\n                  actionPerformed = 'Auto-formatted document';\r\n                  break;\r\n                case 'addBorder':\r\n                  await addBorderToSelection(action.args);\r\n                  actionPerformed = 'Added border to selection';\r\n                  break;\r\n                case 'addPageBorder':\r\n                  await addPageBorder(action.args);\r\n                  actionPerformed = 'Added page border';\r\n                  break;\r\n                case 'addParagraphBorder':\r\n                  await addBorderToParagraphs(action.args);\r\n                  actionPerformed = 'Added border to paragraphs';\r\n                  break;\r\n                case 'removeBorders':\r\n                  await removeBorders(action.args?.target);\r\n                  actionPerformed = 'Removed borders';\r\n                  break;\r\n                case 'addDecorativeBorder':\r\n                  await addDecorativeBorder(action.args);\r\n                  actionPerformed = 'Added decorative border';\r\n                  break;\r\n              }\r\n            } else if (action.type === 'multi-command' && action.multiCommands) {\r\n              // Execute multiple commands in sequence\r\n              const commandResults: string[] = [];\r\n              for (const cmd of action.multiCommands) {\r\n                try {\r\n                  switch (cmd.commandName) {\r\n                    case 'fixHeadings':\r\n                      await fixAllHeadings();\r\n                      commandResults.push('Fixed headings');\r\n                      break;\r\n                    case 'normalizeFonts':\r\n                      await normalizeDocumentFonts(cmd.args?.fontName, cmd.args?.fontSize);\r\n                      commandResults.push('Normalized fonts');\r\n                      break;\r\n                    case 'setMargins':\r\n                      await setDocumentMargins(cmd.args);\r\n                      commandResults.push('Set margins');\r\n                      break;\r\n                    case 'formatImages':\r\n                      await centerAllImages(cmd.args?.padding, cmd.args?.addCaptions, cmd.args?.alignment);\r\n                      commandResults.push('Formatted images');\r\n                      break;\r\n                    case 'updateHeader':\r\n                      await updateAllHeaders(cmd.args?.leftText || '', cmd.args?.rightText || '');\r\n                      commandResults.push('Updated headers');\r\n                      break;\r\n                    case 'updateFooter':\r\n                      await updateAllFooters(\r\n                        cmd.args?.leftText || '',\r\n                        cmd.args?.centerText || '',\r\n                        cmd.args?.rightText || '',\r\n                        cmd.args?.addPageNumbers || false\r\n                      );\r\n                      commandResults.push('Updated footers');\r\n                      break;\r\n                    case 'applyBulletList':\r\n                      await applyBulletList();\r\n                      commandResults.push('Applied bullet list');\r\n                      break;\r\n                    case 'applyNumberedList':\r\n                      await applyNumberedList();\r\n                      commandResults.push('Applied numbered list');\r\n                      break;\r\n                    case 'clearFormatting':\r\n                      await clearFormatting();\r\n                      commandResults.push('Cleared formatting');\r\n                      break;\r\n                    case 'autoFormat':\r\n                      await autoFormatDocument();\r\n                      commandResults.push('Auto-formatted document');\r\n                      break;\r\n                    case 'addBorder':\r\n                      await addBorderToSelection(cmd.args);\r\n                      commandResults.push('Added border');\r\n                      break;\r\n                    case 'addPageBorder':\r\n                      await addPageBorder(cmd.args);\r\n                      commandResults.push('Added page border');\r\n                      break;\r\n                    case 'addParagraphBorder':\r\n                      await addBorderToParagraphs(cmd.args);\r\n                      commandResults.push('Added paragraph border');\r\n                      break;\r\n                    case 'removeBorders':\r\n                      await removeBorders(cmd.args?.target);\r\n                      commandResults.push('Removed borders');\r\n                      break;\r\n                    case 'addDecorativeBorder':\r\n                      await addDecorativeBorder(cmd.args);\r\n                      commandResults.push('Added decorative border');\r\n                      break;\r\n                  }\r\n                } catch (cmdError) {\r\n                  console.error(`Command ${cmd.commandName} failed:`, cmdError);\r\n                  commandResults.push(`${cmd.commandName} failed`);\r\n                }\r\n              }\r\n              actionPerformed = commandResults.join(', ');\r\n            }\r\n          } catch (e) {\r\n            console.error(\"Action failed:\", e);\r\n            actionPerformed = 'Action failed';\r\n          }\r\n        }\r\n      }\r\n\r\n      // In edit mode, no automatic insertion - actions were already executed above\r\n      // The action execution logic handles all insertions/modifications\r\n      // Store payload for potential manual insertion via \"Add to doc\" button\r\n      if (response.action && response.action.content && !payload) {\r\n        payload = response.action.content;\r\n      }\r\n\r\n      const assistantMessage: Message = {\r\n        id: (Date.now() + 1).toString(),\r\n        role: 'assistant',\r\n        content: response.chatResponse,\r\n        payload,\r\n        formatting,\r\n        timestamp: new Date(),\r\n        actionPerformed\r\n      };\r\n\r\n      setMessages((prev) => [...prev, assistantMessage]);\r\n    } catch (error) {\r\n      const errorMessage: Message = {\r\n        id: (Date.now() + 1).toString(),\r\n        role: 'assistant',\r\n        content: `Error: ${error instanceof Error ? error.message : 'Failed to generate content'}`,\r\n        timestamp: new Date(),\r\n      };\r\n      setMessages((prev) => [...prev, errorMessage]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSend();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white dark:bg-gray-900\">\r\n\r\n\r\n      {/* Chat Messages */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {messages.length === 0 ? (\r\n          <div className=\"flex items-center justify-center h-full text-gray-400 dark:text-gray-500\">\r\n            <div className=\"text-center\">\r\n              <svg className=\"w-8 h-8 mx-auto mb-2 text-gray-300 dark:text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\r\n              </svg>\r\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">How can I help?</p>\r\n              <p className=\"text-[10px] text-gray-400 dark:text-gray-500 mt-1\">I can format, write, and edit.</p>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          messages.map((message) => (\r\n            <div\r\n              key={message.id}\r\n              className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\r\n            >\r\n              <div\r\n                className={`max-w-[90%] ${message.role === 'user'\r\n                  ? 'bg-gray-800 dark:bg-blue-600 text-white rounded-lg p-2'\r\n                  : 'text-gray-800 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 rounded-lg p-2'\r\n                  }`}\r\n              >\r\n                <p className=\"text-xs whitespace-pre-wrap break-words\">{message.content}</p>\r\n                {message.attachedFiles && message.attachedFiles.length > 0 && (\r\n                  <div className=\"mt-2 space-y-1\">\r\n                    {message.attachedFiles.map((file, idx) => (\r\n                      <div key={idx} className=\"flex items-center space-x-2 text-[10px] bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\">\r\n                        <svg className=\"w-3 h-3 text-gray-600 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\r\n                        </svg>\r\n                        <span className=\"text-gray-700 dark:text-gray-200 truncate max-w-[150px]\">{file.name}</span>\r\n                        <span className=\"text-gray-500 dark:text-gray-400\">({(file.size / 1024).toFixed(1)} KB)</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n                {message.payload && (\r\n                  <div\r\n                    className=\"mt-2 p-2 bg-white dark:bg-gray-900 rounded border border-gray-200 dark:border-gray-700 text-xs whitespace-pre-wrap break-words shadow-sm overflow-x-auto text-gray-800 dark:text-gray-200\"\r\n                    dangerouslySetInnerHTML={{ __html: parseMarkdownToHtml(message.payload) }}\r\n                  />\r\n                )}\r\n                {message.actionPerformed && (\r\n                  <div className=\"mt-2 text-xs flex items-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded\">\r\n                    <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                    </svg>\r\n                    {message.actionPerformed}\r\n                  </div>\r\n                )}\r\n                <p className=\"text-[10px] mt-1 opacity-70 text-right\">\r\n                  {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                </p>\r\n                {message.role === 'assistant' && chatMode === 'ask' && (\r\n                  <div className=\"mt-2 flex space-x-2 pt-2\">\r\n                    <button\r\n                      onClick={() => handleCopy(message.payload || message.content)}\r\n                      className=\"text-[10px] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 flex items-center\"\r\n                      title=\"Copy\"\r\n                    >\r\n                      <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\" />\r\n                      </svg>\r\n                      Copy\r\n                    </button>\r\n                    {!message.addedToDoc ? (\r\n                      <button\r\n                        onClick={() => handleAddToDoc(message.id, message.payload || message.content, message.formatting)}\r\n                        className=\"text-[10px] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 flex items-center\"\r\n                        title=\"Add to doc\"\r\n                      >\r\n                        <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                        </svg>\r\n                        Add to doc\r\n                      </button>\r\n                    ) : (\r\n                      <button\r\n                        onClick={() => handleUndoAddToDoc(message.id, message.insertedRangeId!)}\r\n                        className=\"text-[10px] text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300 flex items-center\"\r\n                        title=\"Undo\"\r\n                      >\r\n                        <svg className=\"w-3 h-3 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6\" />\r\n                        </svg>\r\n                        Undo\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n        {isLoading && (\r\n          <div className=\"flex justify-start\">\r\n            <div className=\"bg-gray-100 dark:bg-gray-800 rounded-lg p-3\">\r\n              <div className=\"flex space-x-2\">\r\n                <div className=\"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce\"></div>\r\n                <div className=\"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\r\n                <div className=\"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"border-t border-gray-200 dark:border-gray-700 p-2 bg-white dark:bg-gray-900\">\r\n        <div className=\"flex-1 flex flex-col border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800\">\r\n          <div className=\"px-2 pt-1.5 flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <button\r\n                onClick={() => setCanReadDocument(!canReadDocument)}\r\n                className={`text-xs font-bold transition-colors border border-gray-300 dark:border-gray-600 rounded px-2 py-0.5 ${canReadDocument\r\n                  ? 'text-blue-700 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300'\r\n                  : 'text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400'\r\n                  }`}\r\n                title={canReadDocument ? \"Gemini can read full document\" : \"Gemini cannot read full document\"}\r\n                style={{ fontFamily: 'Times New Roman, serif', letterSpacing: '-3px' }}\r\n              >\r\n                WW\r\n              </button>\r\n              <button\r\n                onClick={handleAttachClick}\r\n                className=\"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors p-1\"\r\n                title=\"Attach files (or drag & drop)\"\r\n              >\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              multiple\r\n              onChange={handleFileSelect}\r\n              className=\"hidden\"\r\n              accept=\"*/*\"\r\n            />\r\n          </div>\r\n          {attachedFiles.length > 0 && (\r\n            <div className=\"px-2 pb-1 space-y-1\">\r\n              {attachedFiles.map((file, idx) => (\r\n                <div key={idx} className=\"flex items-center justify-between bg-gray-50 dark:bg-gray-700 px-2 py-1 rounded text-[10px]\">\r\n                  <div className=\"flex items-center space-x-2 flex-1 min-w-0\">\r\n                    <svg className=\"w-3 h-3 text-gray-600 dark:text-gray-300 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\r\n                    </svg>\r\n                    <span className=\"text-gray-700 dark:text-gray-200 truncate\">{file.name}</span>\r\n                    <span className=\"text-gray-500 dark:text-gray-400 flex-shrink-0\">({(file.size / 1024).toFixed(1)} KB)</span>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => handleRemoveFile(idx)}\r\n                    className=\"text-gray-400 hover:text-red-600 ml-2 flex-shrink-0\"\r\n                  >\r\n                    <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <textarea\r\n            ref={textareaRef}\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyPress={handleKeyPress}\r\n            onDragEnter={handleDragEnter}\r\n            onDragOver={handleDragOver}\r\n            onDragLeave={handleDragLeave}\r\n            onDrop={handleDrop}\r\n            placeholder={chatMode === 'ask' ? \"Ask AI...\" : \"Describe changes...\"}\r\n            className={`flex-1 border-none px-3 pt-1 pb-1 text-xs focus:outline-none focus:ring-0 resize-none bg-transparent text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 transition-colors ${isDragging ? 'bg-blue-50 dark:bg-blue-900/20 border-2 border-dashed border-blue-400' : ''\r\n              }`}\r\n            rows={2}\r\n            disabled={isLoading}\r\n          />\r\n          <div className=\"px-2 pb-1.5 flex items-center justify-between space-x-2\">\r\n            <div className=\"flex items-center space-x-2\">\r\n              <select\r\n                value={chatMode}\r\n                onChange={(e) => setChatMode(e.target.value as ChatMode)}\r\n                className=\"text-[10px] border-none bg-transparent p-0 focus:outline-none focus:ring-0 font-medium text-gray-600 dark:text-gray-400 cursor-pointer\"\r\n              >\r\n                <option value=\"ask\">Ask</option>\r\n                <option value=\"edit\">Edit</option>\r\n              </select>\r\n              <span className=\"text-gray-300\">|</span>\r\n              <select\r\n                value={selectedModel}\r\n                onChange={(e) => setSelectedModel(e.target.value as GeminiModel)}\r\n                className=\"text-[10px] border-none bg-transparent p-0 focus:outline-none focus:ring-0 text-gray-500 dark:text-gray-400 cursor-pointer\"\r\n                title=\"Select AI Model\"\r\n              >\r\n                {availableModels.length > 0 ? (\r\n                  availableModels.map((model) => (\r\n                    <option key={model} value={model}>\r\n                      {model.replace('models/', '')}\r\n                    </option>\r\n                  ))\r\n                ) : (\r\n                  <>\r\n                    <option value=\"gemini-2.0-flash-exp\">2.0 Flash (Exp)</option>\r\n                    <option value=\"gemini-2.0-flash-lite\">2.0 Flash Lite</option>\r\n                    <option value=\"gemini-1.5-flash\">1.5 Flash</option>\r\n                    <option value=\"gemini-1.5-flash-8b\">1.5 Flash 8B</option>\r\n                    <option value=\"gemini-1.5-pro\">1.5 Pro</option>\r\n                  </>\r\n                )}\r\n              </select>\r\n            </div>\r\n            <button\r\n              onClick={handleSend}\r\n              disabled={!input.trim() || isLoading}\r\n              className=\"bg-gray-900 dark:bg-blue-600 hover:bg-gray-800 dark:hover:bg-blue-700 disabled:bg-gray-300 dark:disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-md p-1.5 transition-colors flex items-center justify-center\"\r\n            >\r\n              <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatWindow;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\FormatDiffViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\FormatProgressModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\FormatSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\FormattingPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\ImageSettingsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\LoginButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\MarginsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\NormalizeFontsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\components\\SidebarAgents.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\contexts\\AuthContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":99,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":99,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { \r\n  getStoredToken, \r\n  getUserInfo, \r\n  clearToken, \r\n  getStoredUserInfo,\r\n  type UserInfo \r\n} from '../utils/device-auth';\r\n\r\ninterface AuthContextType {\r\n  isLoggedIn: boolean;\r\n  user: UserInfo | null;\r\n  accessToken: string | null;\r\n  login: (token: string, userInfo: UserInfo) => void;\r\n  logout: () => void;\r\n  refreshAuth: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n  const [user, setUser] = useState<UserInfo | null>(null);\r\n  const [accessToken, setAccessToken] = useState<string | null>(null);\r\n\r\n  // Check for existing token on mount\r\n  useEffect(() => {\r\n    refreshAuth();\r\n  }, []);\r\n\r\n  const refreshAuth = async () => {\r\n    const storedToken = getStoredToken();\r\n    const storedUser = getStoredUserInfo();\r\n    \r\n    if (storedToken && storedUser) {\r\n      try {\r\n        // Token exists and hasn't expired, use stored user info\r\n        setAccessToken(storedToken);\r\n        setUser(storedUser);\r\n        setIsLoggedIn(true);\r\n      } catch (error) {\r\n        console.error('Token validation failed:', error);\r\n        // Token is invalid, clear it\r\n        clearToken();\r\n        setAccessToken(null);\r\n        setUser(null);\r\n        setIsLoggedIn(false);\r\n      }\r\n    } else if (storedToken && !storedUser) {\r\n      try {\r\n        // Have token but no user info, fetch it\r\n        const userInfo = await getUserInfo(storedToken);\r\n        setAccessToken(storedToken);\r\n        setUser(userInfo);\r\n        setIsLoggedIn(true);\r\n      } catch (error) {\r\n        console.error('Failed to fetch user info:', error);\r\n        clearToken();\r\n        setAccessToken(null);\r\n        setUser(null);\r\n        setIsLoggedIn(false);\r\n      }\r\n    } else {\r\n      setIsLoggedIn(false);\r\n      setUser(null);\r\n      setAccessToken(null);\r\n    }\r\n  };\r\n\r\n  const login = (token: string, userInfo: UserInfo) => {\r\n    setAccessToken(token);\r\n    setUser(userInfo);\r\n    setIsLoggedIn(true);\r\n  };\r\n\r\n  const logout = () => {\r\n    clearToken();\r\n    setAccessToken(null);\r\n    setUser(null);\r\n    setIsLoggedIn(false);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isLoggedIn,\r\n        user,\r\n        accessToken,\r\n        login,\r\n        logout,\r\n        refreshAuth,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\taskpane\\taskpane.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\types\\env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\types\\formatting.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\types\\google-oauth.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\device-auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3566,3569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3566,3569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Google OAuth 2.0 Device Authorization Flow\r\n * Used by VS Code, GitHub CLI, and other desktop applications\r\n * Opens login in user's REAL system browser with existing cookies/accounts\r\n */\r\n\r\nexport interface DeviceCodeResponse {\r\n  device_code: string;\r\n  user_code: string;\r\n  verification_url: string;\r\n  verification_url_complete?: string;\r\n  expires_in: number;\r\n  interval: number;\r\n}\r\n\r\nexport interface TokenResponse {\r\n  access_token: string;\r\n  token_type: string;\r\n  expires_in: number;\r\n  refresh_token?: string;\r\n  scope: string;\r\n}\r\n\r\nexport interface UserInfo {\r\n  email: string;\r\n  name: string;\r\n  picture: string;\r\n  sub: string;\r\n}\r\n\r\nconst DEVICE_CODE_ENDPOINT = 'https://oauth2.googleapis.com/device/code';\r\nconst TOKEN_ENDPOINT = 'https://oauth2.googleapis.com/token';\r\nconst USER_INFO_ENDPOINT = 'https://www.googleapis.com/oauth2/v3/userinfo';\r\n\r\n// Scopes for device flow\r\n// Note: Gemini API scopes are NOT supported in device flow\r\n// We'll use the token with Gemini API directly (it works with any valid Google OAuth token)\r\nconst SCOPES = [\r\n  'openid',\r\n  'email',\r\n  'profile'\r\n].join(' ');\r\n\r\n/**\r\n * Step 1: Request device code from Google\r\n */\r\nexport async function requestDeviceCode(clientId: string): Promise<DeviceCodeResponse> {\r\n  console.log(' Requesting device code from Google...');\r\n  \r\n  const response = await fetch(DEVICE_CODE_ENDPOINT, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded',\r\n    },\r\n    body: new URLSearchParams({\r\n      client_id: clientId,\r\n      scope: SCOPES,\r\n    }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text();\r\n    throw new Error(`Failed to request device code: ${response.status} - ${error}`);\r\n  }\r\n\r\n  const data: DeviceCodeResponse = await response.json();\r\n  \r\n  console.log(' Device code received');\r\n  console.log(' User code:', data.user_code);\r\n  console.log(' Verification URL:', data.verification_url_complete || data.verification_url);\r\n  console.log(' Expires in:', data.expires_in, 'seconds');\r\n  console.log(' Poll interval:', data.interval, 'seconds');\r\n  \r\n  return data;\r\n}\r\n\r\n/**\r\n * Step 2: Open verification URL in user's REAL system browser\r\n * Uses Office dialog API with displayInIframe: false to ensure system browser\r\n */\r\nexport function openVerificationUrlInBrowser(verificationUrl: string): Promise<void> {\r\n  return new Promise((resolve, _reject) => {\r\n    console.log(' Opening verification URL in system browser...');\r\n    \r\n    // Try Office.js dialog API first (preferred for Office Add-ins)\r\n    if (typeof Office !== 'undefined' && Office.context && Office.context.ui) {\r\n      console.log(' Using Office.context.ui.displayDialogAsync');\r\n      \r\n      Office.context.ui.displayDialogAsync(\r\n        verificationUrl,\r\n        {\r\n          height: 70,\r\n          width: 60,\r\n          displayInIframe: false, // CRITICAL: Forces system browser, not WebView\r\n          promptBeforeOpen: false, // No confirmation dialog\r\n        },\r\n        (result) => {\r\n          if (result.status === Office.AsyncResultStatus.Failed) {\r\n            console.warn(' Office dialog failed, trying fallback:', result.error.message);\r\n            fallbackBrowserOpen(verificationUrl);\r\n            resolve();\r\n          } else {\r\n            console.log(' Browser opened successfully');\r\n            const dialog = result.value;\r\n            \r\n            // User might close the dialog manually\r\n            dialog.addEventHandler(Office.EventType.DialogEventReceived, (_arg: any) => {\r\n              console.log(' Dialog closed by user');\r\n              dialog.close();\r\n            });\r\n            \r\n            resolve();\r\n          }\r\n        }\r\n      );\r\n    } else {\r\n      // Fallback: Use window.open (opens in system browser on most platforms)\r\n      console.log(' Office.js not available, using window.open');\r\n      fallbackBrowserOpen(verificationUrl);\r\n      resolve();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Fallback method to open browser\r\n */\r\nfunction fallbackBrowserOpen(url: string): void {\r\n  // Create a temporary link and click it\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.target = '_blank';\r\n  link.rel = 'noopener noreferrer';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  \r\n  console.log(' Browser opened via fallback method');\r\n}\r\n\r\n/**\r\n * Step 3: Poll Google token endpoint until user completes login\r\n */\r\nexport async function pollForToken(\r\n  clientId: string,\r\n  deviceCode: string,\r\n  interval: number,\r\n  onStatusUpdate?: (status: string) => void\r\n): Promise<TokenResponse> {\r\n  console.log(' Starting token polling...');\r\n  \r\n  const pollInterval = (interval || 5) * 1000; // Convert to milliseconds\r\n  let attempts = 0;\r\n  const maxAttempts = 120; // 10 minutes max (120 * 5 seconds)\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    const poll = async () => {\r\n      attempts++;\r\n      \r\n      if (attempts > maxAttempts) {\r\n        reject(new Error('Polling timeout: User did not complete login in time'));\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        console.log(` Polling attempt ${attempts}...`);\r\n        onStatusUpdate?.(`Waiting for login... (${attempts})`);\r\n        \r\n        const response = await fetch(TOKEN_ENDPOINT, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded',\r\n          },\r\n          body: new URLSearchParams({\r\n            client_id: clientId,\r\n            device_code: deviceCode,\r\n            grant_type: 'urn:ietf:params:oauth:grant-type:device_code',\r\n          }),\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (response.ok) {\r\n          // Success! User completed login\r\n          console.log(' Token received! User login complete.');\r\n          clearInterval(intervalId);\r\n          resolve(data as TokenResponse);\r\n        } else if (data.error === 'authorization_pending') {\r\n          // User hasn't completed login yet, keep polling\r\n          console.log(' Authorization pending, continuing to poll...');\r\n        } else if (data.error === 'slow_down') {\r\n          // Google asks us to slow down\r\n          console.log(' Slowing down polling interval...');\r\n          clearInterval(intervalId);\r\n          setTimeout(() => {\r\n            intervalId = setInterval(poll, pollInterval + 1000);\r\n          }, pollInterval + 1000);\r\n        } else if (data.error === 'expired_token') {\r\n          // Device code expired\r\n          console.error(' Device code expired');\r\n          clearInterval(intervalId);\r\n          reject(new Error('Device code expired. Please try logging in again.'));\r\n        } else if (data.error === 'access_denied') {\r\n          // User denied access\r\n          console.error(' User denied access');\r\n          clearInterval(intervalId);\r\n          reject(new Error('Access denied by user'));\r\n        } else {\r\n          // Unknown error\r\n          console.error(' Unknown error:', data);\r\n          clearInterval(intervalId);\r\n          reject(new Error(`Authentication error: ${data.error}`));\r\n        }\r\n      } catch (error) {\r\n        console.error(' Polling error:', error);\r\n        // Don't stop polling on network errors, keep trying\r\n      }\r\n    };\r\n\r\n    // Start polling\r\n    let intervalId = setInterval(poll, pollInterval);\r\n    poll(); // First poll immediately\r\n  });\r\n}\r\n\r\n/**\r\n * Get user information using access token\r\n */\r\nexport async function getUserInfo(accessToken: string): Promise<UserInfo> {\r\n  console.log(' Fetching user information...');\r\n  \r\n  const response = await fetch(USER_INFO_ENDPOINT, {\r\n    headers: {\r\n      'Authorization': `Bearer ${accessToken}`,\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to get user info: ${response.status}`);\r\n  }\r\n\r\n  const userInfo: UserInfo = await response.json();\r\n  console.log(' User info retrieved:', userInfo.email);\r\n  \r\n  return userInfo;\r\n}\r\n\r\n/**\r\n * Complete device flow: Request code, open browser, poll for token\r\n */\r\nexport async function executeDeviceFlow(\r\n  clientId: string,\r\n  onStatusUpdate?: (status: string) => void,\r\n  onUserCodeReceived?: (userCode: string, verificationUrl: string) => void\r\n): Promise<{ token: TokenResponse; userInfo: UserInfo }> {\r\n  try {\r\n    // Step 1: Request device code\r\n    onStatusUpdate?.('Requesting authorization...');\r\n    const deviceCodeData = await requestDeviceCode(clientId);\r\n    \r\n    // Notify UI about user code (optional: show it to user)\r\n    onUserCodeReceived?.(\r\n      deviceCodeData.user_code,\r\n      deviceCodeData.verification_url_complete || deviceCodeData.verification_url\r\n    );\r\n    \r\n    // Step 2: Open browser for user to login\r\n    onStatusUpdate?.('Opening browser for login...');\r\n    const verificationUrl = deviceCodeData.verification_url_complete || \r\n                           `${deviceCodeData.verification_url}?user_code=${deviceCodeData.user_code}`;\r\n    \r\n    await openVerificationUrlInBrowser(verificationUrl);\r\n    \r\n    // Step 3: Poll for token\r\n    onStatusUpdate?.('Waiting for you to complete login in browser...');\r\n    const token = await pollForToken(\r\n      clientId,\r\n      deviceCodeData.device_code,\r\n      deviceCodeData.interval,\r\n      onStatusUpdate\r\n    );\r\n    \r\n    // Step 4: Get user info\r\n    onStatusUpdate?.('Getting user information...');\r\n    const userInfo = await getUserInfo(token.access_token);\r\n    \r\n    return { token, userInfo };\r\n    \r\n  } catch (error) {\r\n    console.error(' Device flow failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Storage helpers\r\n */\r\n\r\nexport function storeToken(token: TokenResponse): void {\r\n  const expiresAt = Date.now() + token.expires_in * 1000;\r\n  \r\n  localStorage.setItem('google_access_token', token.access_token);\r\n  localStorage.setItem('google_token_expires_at', expiresAt.toString());\r\n  localStorage.setItem('google_token_type', token.token_type);\r\n  localStorage.setItem('google_token_scope', token.scope);\r\n  \r\n  if (token.refresh_token) {\r\n    localStorage.setItem('google_refresh_token', token.refresh_token);\r\n  }\r\n  \r\n  console.log(' Token stored in localStorage');\r\n  console.log(` Token expires at: ${new Date(expiresAt).toLocaleString()}`);\r\n}\r\n\r\nexport function getStoredToken(): string | null {\r\n  const token = localStorage.getItem('google_access_token');\r\n  const expiresAt = localStorage.getItem('google_token_expires_at');\r\n  \r\n  if (!token || !expiresAt) {\r\n    return null;\r\n  }\r\n  \r\n  // Check if token is expired\r\n  if (Date.now() >= parseInt(expiresAt)) {\r\n    console.warn(' Stored token has expired');\r\n    clearToken();\r\n    return null;\r\n  }\r\n  \r\n  return token;\r\n}\r\n\r\nexport function clearToken(): void {\r\n  localStorage.removeItem('google_access_token');\r\n  localStorage.removeItem('google_token_expires_at');\r\n  localStorage.removeItem('google_token_type');\r\n  localStorage.removeItem('google_token_scope');\r\n  localStorage.removeItem('google_refresh_token');\r\n  localStorage.removeItem('google_user_info');\r\n  \r\n  console.log(' Token cleared from storage');\r\n}\r\n\r\nexport function storeUserInfo(userInfo: UserInfo): void {\r\n  localStorage.setItem('google_user_info', JSON.stringify(userInfo));\r\n  console.log(' User info stored');\r\n}\r\n\r\nexport function getStoredUserInfo(): UserInfo | null {\r\n  const data = localStorage.getItem('google_user_info');\r\n  if (!data) return null;\r\n  \r\n  try {\r\n    return JSON.parse(data);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get access token directly (for gemini.ts compatibility)\r\n */\r\nexport function getAccessToken(): string | null {\r\n  return getStoredToken();\r\n}\r\n\r\n/**\r\n * Get refresh token if available\r\n */\r\nexport function getRefreshToken(): string | null {\r\n  return localStorage.getItem('google_refresh_token');\r\n}\r\n\r\n/**\r\n * Store tokens (for gemini.ts compatibility)\r\n */\r\nexport function storeTokens(tokenResponse: TokenResponse): void {\r\n  storeToken(tokenResponse);\r\n}\r\n\r\n/**\r\n * Refresh access token using refresh token\r\n */\r\nexport async function refreshAccessToken(refreshToken: string): Promise<TokenResponse> {\r\n  console.log(' Refreshing access token...');\r\n  \r\n  const response = await fetch(TOKEN_ENDPOINT, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded',\r\n    },\r\n    body: new URLSearchParams({\r\n      client_id: localStorage.getItem('google_client_id') || '',\r\n      refresh_token: refreshToken,\r\n      grant_type: 'refresh_token',\r\n    }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text();\r\n    throw new Error(`Failed to refresh token: ${response.status} - ${error}`);\r\n  }\r\n\r\n  const data: TokenResponse = await response.json();\r\n  console.log(' Token refreshed');\r\n  \r\n  return data;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\formatting\\auditLogger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\formatting\\diffGenerator.ts","messages":[{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":18,"column":13,"nodeType":"LogicalExpression","messageId":"unexpected","endLine":18,"endColumn":44}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { DocumentModel, Problem, FormatChange, AutoFormatOptions } from '../../types/formatting';\r\nimport { fixAllHeadings } from '../wordUtils';\r\nimport { cleanWhitespace, normalizeLists, styleTables, resizeImages, normalizeFonts } from './localFixes';\r\n\r\n/* global Word */\r\n\r\nexport const generateDiff = (\r\n    model: DocumentModel,\r\n    problems: Problem[],\r\n    options: AutoFormatOptions\r\n): FormatChange[] => {\r\n    const changes: FormatChange[] = [];\r\n\r\n    // Font Changes\r\n    if (options.enableFonts) {\r\n        const fontProblems = problems.filter(p => p.id.startsWith('font-'));\r\n        if (fontProblems.length > 0 || true) { // Always check/offer if enabled\r\n            changes.push({\r\n                id: 'normalize-fonts',\r\n                type: 'style',\r\n                category: 'Fonts',\r\n                description: `Normalize fonts to Calibri 11pt`,\r\n                before: 'Mixed fonts',\r\n                after: 'Calibri 11pt',\r\n                range: { start: 0, end: model.paragraphs.length },\r\n                applyFn: async () => {\r\n                    // We need context here. The applyFn in FormattingPanel calls it.\r\n                    // But wait, applyFn in FormattingPanel is just `await change.applyFn()`.\r\n                    // The functions in wordUtils use Word.run internally.\r\n                    // My localFixes functions expect `context`.\r\n                    // This is a mismatch. \r\n                    // I need to wrap them in Word.run here or in localFixes.\r\n\r\n                    // Let's check localFixes again. \r\n                    // They take `context`.\r\n                    // wordUtils functions wrap Word.run.\r\n\r\n                    // I should wrap them here or update localFixes to wrap Word.run.\r\n                    // Updating localFixes is better for consistency with wordUtils.\r\n\r\n                    // Wait, I can't update localFixes in this tool call.\r\n                    // I will assume I will update localFixes to wrap Word.run.\r\n                    await normalizeFontsWrapper();\r\n                },\r\n                enabled: true\r\n            });\r\n        }\r\n    }\r\n\r\n    // Heading Changes\r\n    if (options.enableHeadings) {\r\n        changes.push({\r\n            id: 'fix-headings',\r\n            type: 'style',\r\n            category: 'Headings',\r\n            description: 'Standardize all heading styles',\r\n            before: 'Inconsistent heading styles',\r\n            after: 'Standardized headings (H1: 16pt, H2: 14pt)',\r\n            range: { start: 0, end: model.paragraphs.length },\r\n            applyFn: async () => await fixAllHeadings(),\r\n            enabled: true\r\n        });\r\n    }\r\n\r\n    // Spacing Changes\r\n    if (options.enableSpacing) {\r\n        changes.push({\r\n            id: 'fix-spacing',\r\n            type: 'spacing',\r\n            category: 'Spacing',\r\n            description: `Remove extra blank lines`,\r\n            before: 'Multiple blank lines',\r\n            after: 'Single blank lines',\r\n            range: { start: 0, end: model.paragraphs.length },\r\n            applyFn: async () => await cleanWhitespaceWrapper(),\r\n            enabled: true\r\n        });\r\n    }\r\n\r\n    // List Changes\r\n    if (options.enableLists) {\r\n        changes.push({\r\n            id: 'fix-lists',\r\n            type: 'style',\r\n            category: 'Lists',\r\n            description: 'Normalize list styles',\r\n            before: 'Mixed list styles',\r\n            after: 'Standardized lists',\r\n            range: { start: 0, end: model.paragraphs.length },\r\n            applyFn: async () => await normalizeListsWrapper(),\r\n            enabled: true\r\n        });\r\n    }\r\n\r\n    // Table Changes\r\n    if (options.enableTables) {\r\n        changes.push({\r\n            id: 'fix-tables',\r\n            type: 'style',\r\n            category: 'Tables',\r\n            description: 'Apply standard table style',\r\n            before: 'Unstyled tables',\r\n            after: 'Grid Table 4 - Accent 1',\r\n            range: { start: 0, end: model.paragraphs.length }, // Approximate\r\n            applyFn: async () => await styleTablesWrapper(),\r\n            enabled: true\r\n        });\r\n    }\r\n\r\n    // Image Changes\r\n    if (options.enableImages) {\r\n        changes.push({\r\n            id: 'fix-images',\r\n            type: 'image',\r\n            category: 'Images',\r\n            description: `Resize and wrap images`,\r\n            before: 'Various sizes/wrapping',\r\n            after: 'Resized to fit page',\r\n            range: { start: 0, end: 0 },\r\n            applyFn: async () => await resizeImagesWrapper(),\r\n            enabled: true\r\n        });\r\n    }\r\n\r\n    return changes;\r\n};\r\n\r\n// Wrappers to handle Word.run since localFixes functions expect context\r\n// Ideally localFixes should export these wrappers.\r\n\r\nconst normalizeFontsWrapper = async () => {\r\n    await Word.run(async (context) => {\r\n        await normalizeFonts(context);\r\n    });\r\n};\r\n\r\nconst cleanWhitespaceWrapper = async () => {\r\n    await Word.run(async (context) => {\r\n        await cleanWhitespace(context);\r\n    });\r\n};\r\n\r\nconst normalizeListsWrapper = async () => {\r\n    await Word.run(async (context) => {\r\n        await normalizeLists(context);\r\n    });\r\n};\r\n\r\nconst styleTablesWrapper = async () => {\r\n    await Word.run(async (context) => {\r\n        await styleTables(context);\r\n    });\r\n};\r\n\r\nconst resizeImagesWrapper = async () => {\r\n    await Word.run(async (context) => {\r\n        await resizeImages(context);\r\n    });\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\formatting\\documentAnalyzer.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'listLevel' is never reassigned. Use 'const' instead.","line":26,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":26,"endColumn":22,"fix":{"range":[1041,1060],"text":"const listLevel = -1;"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\r\n/* global Word */\r\nimport { DocumentModel, ParagraphInfo, TableInfo, ImageInfo, SectionInfo, HeaderFooterInfo } from '../../types/formatting';\r\n\r\nexport const buildDocumentModel = async (context: Word.RequestContext): Promise<DocumentModel> => {\r\n    const body = context.document.body;\r\n    const paragraphs = body.paragraphs;\r\n    const tables = body.tables;\r\n    const sections = context.document.sections;\r\n\r\n    // Load necessary properties\r\n    paragraphs.load('items, style, font, alignment, lineSpacing, listItemOrNullObject');\r\n    tables.load('items, rowCount, rowCount');\r\n    sections.load('items, pageSetup');\r\n\r\n    // Load images (inline pictures)\r\n    const images = body.inlinePictures;\r\n    images.load('items, width, height, altTextTitle, altTextDescription, hyperlink');\r\n\r\n    await context.sync();\r\n\r\n    // Process paragraphs\r\n    const paragraphInfos: ParagraphInfo[] = paragraphs.items.map((p, index) => {\r\n        // Check if it's a list item\r\n        const isListItem = p.listItemOrNullObject !== null;\r\n        let listLevel = -1;\r\n\r\n        // We need to load list level separately if it is a list item, \r\n        // but for now we'll just mark it. In a real deep analysis we'd load levels.\r\n\r\n        const styleName = p.style as string;\r\n        const isHeading = styleName.toLowerCase().includes('heading');\r\n        let headingLevel = 0;\r\n        if (isHeading) {\r\n            const match = styleName.match(/Heading\\s+(\\d+)/i);\r\n            if (match) headingLevel = parseInt(match[1]);\r\n        }\r\n\r\n        return {\r\n            index,\r\n            text: p.text,\r\n            style: styleName,\r\n            fontName: p.font.name,\r\n            fontSize: p.font.size,\r\n            alignment: p.alignment as Word.Alignment,\r\n            lineSpacing: p.lineSpacing,\r\n            isListItem,\r\n            listLevel,\r\n            isHeading,\r\n            headingLevel\r\n        };\r\n    });\r\n\r\n    // Process tables\r\n    const tableInfos: TableInfo[] = tables.items.map((t, index) => ({\r\n        index,\r\n        rowCount: t.rowCount,\r\n        columnCount: t.values[0]?.length || 0, // Approximate column count from first row\r\n        hasHeaderRow: true // Assumption, would need more checks\r\n    }));\r\n\r\n    // Process images\r\n    const imageInfos: ImageInfo[] = images.items.map((img, index) => ({\r\n        index,\r\n        width: img.width,\r\n        height: img.height,\r\n        hasAltText: !!img.altTextTitle || !!img.altTextDescription,\r\n        wrapping: 'inline' // Inline pictures are always inline\r\n    }));\r\n\r\n    // Process sections\r\n    const sectionInfos: SectionInfo[] = sections.items.map((s, index) => ({\r\n        index,\r\n        pageMargins: {\r\n            top: s.pageSetup.topMargin,\r\n            bottom: s.pageSetup.bottomMargin,\r\n            left: s.pageSetup.leftMargin,\r\n            right: s.pageSetup.rightMargin\r\n        }\r\n    }));\r\n\r\n    // Process headers/footers (simplified - just primary for first section)\r\n    const headers: HeaderFooterInfo[] = [];\r\n    const footers: HeaderFooterInfo[] = [];\r\n\r\n    if (sections.items.length > 0) {\r\n        // In a full implementation, we'd load these. \r\n        // For now, we'll skip deep loading to avoid too many syncs in this initial pass\r\n    }\r\n\r\n    return {\r\n        paragraphs: paragraphInfos,\r\n        tables: tableInfos,\r\n        images: imageInfos,\r\n        sections: sectionInfos,\r\n        headers,\r\n        footers\r\n    };\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\formatting\\localFixes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\formatting\\problemDetector.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\formatting\\templateManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\gemini.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4931,4934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4931,4934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5039,5042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5039,5042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'mergedResponse' is never reassigned. Use 'const' instead.","line":1151,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":1151,"endColumn":39,"fix":{"range":[60217,60356],"text":"const mergedResponse: AIResponse = {\r\n          chatResponse: \"\",\r\n          action: { type: 'multi-command', multiCommands: [] }\r\n        };"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1156,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1156,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60383,60386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60383,60386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1158,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1158,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60428,60431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60428,60431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1176,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1176,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61103,61106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61103,61106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\r\n * Gemini AI Integration\r\n * Uses @google/genai SDK with API Key authentication\r\n */\r\n\r\nimport { GoogleGenAI } from \"@google/genai\";\r\nimport { env } from \"./env\";\r\n\r\nlet aiClient: GoogleGenAI | null = null;\r\n\r\n/**\r\n * Get or initialize the Gemini AI client\r\n */\r\nconst STORAGE_KEY = 'user_gemini_api_key';\r\n\r\n/**\r\n * Save API Key\r\n */\r\nexport const setApiKey = (key: string) => {\r\n  localStorage.setItem(STORAGE_KEY, key);\r\n  aiClient = null; // Reset client to force re-initialization\r\n};\r\n\r\n/**\r\n * Remove API Key\r\n */\r\nexport const clearApiKey = () => {\r\n  localStorage.removeItem(STORAGE_KEY);\r\n  aiClient = null;\r\n};\r\n\r\n/**\r\n * Check if API Key exists\r\n */\r\nexport const hasApiKey = (): boolean => {\r\n  return !!(localStorage.getItem(STORAGE_KEY) || env.geminiApiKey);\r\n};\r\n\r\n/**\r\n * List available models from Gemini API\r\n */\r\nexport const listModels = async (): Promise<string[]> => {\r\n  try {\r\n    const ai = getAIClient();\r\n    const modelsPager = await ai.models.list();\r\n    const modelsList: string[] = [];\r\n\r\n    // Iterate through the pager to get all models\r\n    for await (const model of modelsPager) {\r\n      if (model.name) {\r\n        modelsList.push(model.name);\r\n      }\r\n    }\r\n\r\n    return modelsList;\r\n  } catch (error) {\r\n    console.error(\" Failed to fetch models:\", error);\r\n    // Return default models as fallback\r\n    return [\r\n      \"gemini-2.0-flash-exp\",\r\n      \"gemini-2.0-flash-lite\",\r\n      \"gemini-1.5-flash\",\r\n      \"gemini-1.5-flash-8b\",\r\n      \"gemini-1.5-pro\"\r\n    ];\r\n  }\r\n};\r\n\r\n/**\r\n * Get or initialize the Gemini AI client\r\n */\r\nconst getAIClient = (): GoogleGenAI => {\r\n  if (!aiClient) {\r\n    // Prioritize user-provided key, fallback to env key\r\n    const apiKey = localStorage.getItem(STORAGE_KEY) || env.geminiApiKey;\r\n\r\n    if (!apiKey || apiKey.includes(\"YOUR_\")) {\r\n      throw new Error(\r\n        \"Gemini API Key missing. Please provide your key.\"\r\n      );\r\n    }\r\n\r\n    aiClient = new GoogleGenAI({ apiKey });\r\n  }\r\n\r\n  return aiClient;\r\n};\r\n\r\nexport interface AttachedFile {\r\n  name: string;\r\n  size: number;\r\n  type: string;\r\n  content: string; // base64 encoded content\r\n}\r\n\r\n/**\r\n * Generate content using Gemini API\r\n */\r\nexport const generateContent = async (prompt: string, model: string = \"gemini-2.0-flash-lite\"): Promise<string> => {\r\n  try {\r\n    const ai = getAIClient();\r\n\r\n    const response = await ai.models.generateContent({\r\n      model,\r\n      contents: prompt,\r\n      config: {\r\n        thinkingConfig: {\r\n          thinkingBudget: 0, // Disables thinking for faster responses\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!response.text) {\r\n      throw new Error(\"No response from Gemini AI\");\r\n    }\r\n\r\n    return response.text;\r\n  } catch (error) {\r\n    console.error(\" Gemini API error:\", error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Improve writing using Gemini\r\n */\r\nexport const improveWriting = async (text: string, model?: string) => {\r\n  const prompt =\r\n    `Improve the text. Only return the improved version:\\n\\n${text}`;\r\n  return generateContent(prompt, model);\r\n};\r\n\r\n/**\r\n * Summarize text\r\n */\r\nexport const summarizeText = async (text: string, model?: string) => {\r\n  const prompt = `Summarize the following:\\n\\n${text}`;\r\n  return generateContent(prompt, model);\r\n};\r\n\r\n/**\r\n * Format text\r\n */\r\nexport const formatText = async (text: string, model?: string) => {\r\n  const prompt = `Format this text professionally:\\n\\n${text}`;\r\n  return generateContent(prompt, model);\r\n};\r\n\r\n/**\r\n * Generate based on instruction\r\n */\r\nexport const generateFromInstruction = async (instruction: string, model?: string) => {\r\n  return generateContent(instruction, model);\r\n};\r\n\r\n/**\r\n * Clean markdown formatting and convert to plain text\r\n */\r\nexport const cleanMarkdownFormatting = (text: string): string => {\r\n  return text\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '$1') // Remove **bold**\r\n    .replace(/__(.*?)__/g, '$1') // Remove __bold__\r\n    .replace(/\\*(.*?)\\*/g, '$1') // Remove *italic*\r\n    .replace(/_(.*?)_/g, '$1') // Remove _italic_\r\n    .replace(/`(.*?)`/g, '$1') // Remove `code`\r\n    .replace(/\\[(.*?)\\]\\(.*?\\)/g, '$1') // Remove [link](url)\r\n    .trim();\r\n};\r\n\r\nexport interface AIAction {\r\n  type: 'replace' | 'format' | 'insert' | 'chat' | 'command' | 'multi-command';\r\n  content?: string; // For replace/insert/chat\r\n  formatting?: {\r\n    bold?: boolean;\r\n    italic?: boolean;\r\n    underline?: boolean;\r\n    fontName?: string;\r\n    fontSize?: number;\r\n    color?: string;\r\n    alignment?: 'left' | 'center' | 'right' | 'justify';\r\n    lineSpacing?: number;\r\n    spaceAfter?: number;\r\n    spaceBefore?: number;\r\n  };\r\n  commandName?: 'fixHeadings' | 'normalizeFonts' | 'setMargins' | 'formatImages' | 'updateHeader' | 'updateFooter' | 'applyTheme' | 'applyBulletList' | 'applyNumberedList' | 'clearFormatting' | 'autoFormat' | 'addBorder' | 'addPageBorder' | 'addParagraphBorder' | 'removeBorders' | 'addDecorativeBorder';\r\n  args?: any;\r\n  target?: 'selection' | 'document';\r\n  multiCommands?: Array<{\r\n    commandName: string;\r\n    args?: any;\r\n  }>;\r\n}\r\n\r\nexport interface AIResponse {\r\n  chatResponse: string;\r\n  action?: AIAction;\r\n}\r\n\r\n/**\r\n * Generate actionable content using Gemini API\r\n */\r\nexport const generateActionableContent = async (\r\n  prompt: string,\r\n  contextText: string,\r\n  hasSelection: boolean,\r\n  model: string = \"gemini-2.0-flash-lite\",\r\n  attachedFiles?: AttachedFile[]\r\n): Promise<AIResponse> => {\r\n  try {\r\n    const ai = getAIClient();\r\n\r\n    const systemPrompt = `\r\n\r\n                  ADVANCED MICROSOFT WORD AI ENGINE v3.0                    \r\n          Professional Document Engineering & Intelligent Formatting        \r\n\r\n\r\nYou are an elite \"Document Engineering AI\" powered by Google's Gemini, specialized in creating \r\nPUBLICATION-GRADE Microsoft Word documents with advanced formatting, professional layouts, and \r\ncomprehensive knowledge-driven content.\r\n\r\n\r\n CORE MISSION\r\n\r\nGenerate ACTUAL, COMPLETE, KNOWLEDGE-RICH content with sophisticated Word formatting.\r\nThink like a professional technical writer, editor, and document designer combined.\r\n\r\nMANDATORY PRINCIPLES:\r\n NO placeholders like \"[Insert content here]\" or \"TODO: Add details\"\r\n USE your vast knowledge to provide specific facts, data, examples, and insights\r\n APPLY engineering-level document formatting (headers, footers, margins, styles, themes)\r\n ANTICIPATE user needs - be proactive with formatting suggestions\r\n THINK holistically about document structure, not just text content\r\n\r\n\r\n CONTEXT INFORMATION\r\n\r\nSelection Status: ${hasSelection ? \" User has selected text\" : \" Whole document view\"}\r\nDocument Context: \"${contextText.substring(0, 2000)}${contextText.length > 2000 ? \"...\" : \"\"}\"\r\nUser Request: \"${prompt}\"\r\n${attachedFiles && attachedFiles.length > 0 ? `\r\n ATTACHED FILES (${attachedFiles.length}):\r\n${attachedFiles.map((file, idx) => {\r\n      // Decode base64 content for text-based files\r\n      let fileContent = '';\r\n      try {\r\n        const decoded = atob(file.content);\r\n        // Check if it's likely text content (not binary)\r\n        if (file.type.includes('text') || file.type.includes('json') || file.type.includes('xml') ||\r\n          file.name.endsWith('.txt') || file.name.endsWith('.md') || file.name.endsWith('.py') ||\r\n          file.name.endsWith('.js') || file.name.endsWith('.ts') || file.name.endsWith('.java') ||\r\n          file.name.endsWith('.c') || file.name.endsWith('.cpp') || file.name.endsWith('.cs') ||\r\n          file.name.endsWith('.html') || file.name.endsWith('.css') || file.name.endsWith('.json') ||\r\n          file.name.endsWith('.xml') || file.name.endsWith('.yaml') || file.name.endsWith('.yml') ||\r\n          file.name.endsWith('.sql') || file.name.endsWith('.sh') || file.name.endsWith('.bat')) {\r\n          fileContent = decoded.substring(0, 5000); // Limit to 5000 chars per file\r\n          if (decoded.length > 5000) fileContent += '\\n... (truncated)';\r\n        } else if (file.type.includes('pdf') || file.type.includes('word') || file.type.includes('document')) {\r\n          fileContent = '[Binary document - extract and analyze key content/structure]';\r\n        } else {\r\n          fileContent = '[Binary file - analyze as needed]';\r\n        }\r\n      } catch (e) {\r\n        fileContent = '[Unable to decode file content]';\r\n      }\r\n      return `File ${idx + 1}: \"${file.name}\" (${(file.size / 1024).toFixed(1)} KB, ${file.type})\\nContent:\\n${fileContent}\\n`;\r\n    }).join('\\n')}\r\n` : ''}\r\n\r\n\r\n DOCUMENT ENGINEERING CAPABILITIES\r\n\r\n\r\nYou have FULL ACCESS to Microsoft Word's professional features:\r\n\r\n CONTENT & STRUCTURE:\r\n   Headings (Heading 1, 2, 3, 4) with automatic hierarchy\r\n   Body paragraphs with proper spacing and indentation\r\n   Executive summaries, abstracts, conclusions\r\n   Table of contents generation (via proper heading styles)\r\n   Footnotes and endnotes (via superscript references)\r\n\r\n DATA PRESENTATION:\r\n   Complex tables with headers, merged cells, alternating row colors\r\n   Lists (bulleted, numbered, multi-level outlines)\r\n   Data comparisons in tabular format\r\n   Statistical presentations\r\n   Timeline layouts\r\n  \r\n VISUAL FORMATTING:\r\n   Themes (Office, Academic, Professional, Modern, Classic)\r\n   Font schemes (Calibri+Calibri Light, Arial+Georgia, Times+Arial)\r\n   Color schemes (Blue corporate, Red accent, Green tech, Monochrome)\r\n   Paragraph spacing (tight: 0pt, normal: 6pt, loose: 12pt)\r\n   Line spacing (1.0, 1.15, 1.5, 2.0, Multiple)\r\n  \r\n PAGE LAYOUT:\r\n   Margins (Normal: 1\", Narrow: 0.5\", Moderate, Wide: 2\")\r\n   Page orientation (Portrait, Landscape)\r\n   Columns (1, 2, 3 column layouts)\r\n   Section breaks for mixed layouts\r\n   Page borders and shading\r\n  \r\n BORDERS - COMPREHENSIVE SUPPORT:\r\n  \r\n  BORDER TYPES AVAILABLE:\r\n   Selection Borders: Border around selected text/content\r\n   Page Borders: Borders around entire page(s)\r\n   Paragraph Borders: Borders around specific paragraphs\r\n   Decorative Borders: Styled boxes with background colors\r\n  \r\n  BORDER STYLES:\r\n   solid: Standard solid line (most common)\r\n   double: Two parallel lines (elegant, formal)\r\n   dotted: Dotted line (casual, informal)\r\n   dashed: Dashed line (modern)\r\n   triple: Three parallel lines (decorative)\r\n   wave/wavy: Wavy line (creative, playful)\r\n  \r\n  BORDER COLORS:\r\n   Any hex color: #000000 (black), #0078D4 (blue), #FF0000 (red)\r\n   RGB colors: rgb(0,0,0)\r\n   Named colors: black, blue, red, green, gold, silver\r\n  \r\n  BORDER WIDTH/THICKNESS:\r\n   Thin: 1pt (subtle)\r\n   Medium: 2-3pt (standard)\r\n   Thick: 4-6pt (prominent)\r\n   Extra thick: 8-10pt (decorative)\r\n  \r\n  WHEN TO USE BORDERS:\r\n   Highlight important sections (quotes, warnings, key points)\r\n   Create visual separation between sections\r\n   Add decorative elements to enhance design\r\n   Frame tables or images\r\n   Create certificate/award document effects\r\n   Professional document branding\r\n  \r\n  BORDER COMMAND EXAMPLES:\r\n  \r\n  1. Add border to selection:\r\n  {\r\n    \"commandName\": \"addBorder\",\r\n    \"args\": {\r\n      \"style\": \"solid\",\r\n      \"color\": \"#000000\",\r\n      \"width\": 2\r\n    }\r\n  }\r\n  \r\n  2. Add page border to all pages:\r\n  {\r\n    \"commandName\": \"addPageBorder\",\r\n    \"args\": {\r\n      \"style\": \"double\",\r\n      \"color\": \"#0078D4\",\r\n      \"width\": 6,\r\n      \"applyToAllPages\": true\r\n    }\r\n  }\r\n  \r\n  3. Add decorative border with background:\r\n  {\r\n    \"commandName\": \"addDecorativeBorder\",\r\n    \"args\": {\r\n      \"style\": \"double\",\r\n      \"color\": \"#0078D4\",\r\n      \"width\": 4,\r\n      \"padding\": 15,\r\n      \"shading\": \"#F0F8FF\"\r\n    }\r\n  }\r\n  \r\n  4. Add border to specific paragraphs:\r\n  {\r\n    \"commandName\": \"addParagraphBorder\",\r\n    \"args\": {\r\n      \"style\": \"solid\",\r\n      \"color\": \"#FF6B6B\",\r\n      \"width\": 2,\r\n      \"target\": \"selection\",\r\n      \"borderPosition\": \"all\"\r\n    }\r\n  }\r\n  \r\n  5. Remove borders:\r\n  {\r\n    \"commandName\": \"removeBorders\",\r\n    \"args\": {\r\n      \"target\": \"selection\"\r\n    }\r\n  }\r\n  \r\n  BORDER USE CASES:\r\n   User says \"add a border\"  Use addBorder with default solid black\r\n   User says \"add page border\"  Use addPageBorder\r\n   User says \"red border\"  Set color: \"#FF0000\"\r\n   User says \"thick border\"  Set width: 6\r\n   User says \"double border\"  Set style: \"double\"\r\n   User says \"wavy border\" or \"curly border\"  Set style: \"wave\"\r\n   User says \"decorative box\"  Use addDecorativeBorder\r\n   User says \"border around this\" (selection)  Use addBorder\r\n   User says \"border on all pages\"  Use addPageBorder with applyToAllPages: true\r\n   User says \"colorful border\"  Choose vibrant color like #0078D4, #FF6B6B, #4CAF50\r\n\r\n HEADERS & FOOTERS:\r\n   Headers (left aligned, centered, right aligned)\r\n   Footers with page numbers (bottom center, bottom right)\r\n   Document title, author, date stamps\r\n   Chapter/section names in headers\r\n   Confidentiality notices in footers\r\n  \r\n IMAGES & GRAPHICS:\r\n   Image alignment (left, center, right, inline)\r\n   Text wrapping (square, tight, through, top/bottom)\r\n   Image sizing (width, height, aspect ratio)\r\n   Captions (\"Figure 1: Description\")\r\n   Alt text for accessibility\r\n  \r\n STYLES & THEMES:\r\n   Built-in styles (Normal, Title, Subtitle, Quote, Intense Quote)\r\n   Custom font combinations\r\n   Consistent color palettes\r\n   Professional document themes\r\n\r\n\r\n FORMATTING INTELLIGENCE - AUTO-DETECT DOCUMENT TYPES\r\n\r\n\r\nPROACTIVELY identify document type from user request and apply appropriate formatting:\r\n\r\n\r\n  TECHNICAL REPORTS / RESEARCH PAPERS                                      \r\n\r\n  Font: Georgia 11pt body, Calibri 16/14/12pt headings                     \r\n  Margins: 1\" all sides (Normal)                                           \r\n  Spacing: 1.5 line spacing, 6pt after paragraphs                          \r\n  Alignment: Justify body text                                             \r\n  Structure: Title page  Abstract  ToC  Introduction  Methodology      \r\n    Results  Discussion  Conclusion  References                         \r\n  Headers: Document title (right), Footer: Page numbers (center)           \r\n  Tables: Grid borders, header row bold, alternating row shading           \r\n  Images: Centered with Figure captions                                    \r\n\r\n\r\n\r\n  BUSINESS PROPOSALS / EXECUTIVE SUMMARIES                                 \r\n\r\n  Font: Calibri 11pt body, Calibri Light 18/14pt headings                 \r\n  Margins: Moderate (1\" top/bottom, 0.75\" sides)                           \r\n  Spacing: 1.15 line spacing, 8pt after paragraphs                         \r\n  Alignment: Left for readability                                          \r\n  Colors: Corporate blue (#0078D4) for headings, black body                \r\n  Headers: Company logo area (left), Date (right)                          \r\n  Footer: Confidential notice (left), Page X of Y (right)                  \r\n  Use bullet points extensively for key takeaways                          \r\n  Include executive summary box (shaded background)                        \r\n\r\n\r\n\r\n  LEGAL DOCUMENTS / CONTRACTS                                              \r\n\r\n  Font: Times New Roman 12pt (traditional legal standard)                  \r\n  Margins: 1\" all sides                                                    \r\n  Spacing: Double-spaced (2.0), 0pt spacing between paragraphs            \r\n  Alignment: Justify (full justification)                                  \r\n  Numbering: Multi-level numbered sections (1.0, 1.1, 1.1.1)              \r\n  Headers: Document name + date                                            \r\n  Footer: Page numbers, \"Draft\" or \"Final\" watermark                       \r\n  No colors - pure black and white                                         \r\n  Use ALL CAPS for section headers                                         \r\n\r\n\r\n\r\n  NEWSLETTERS / ARTICLES                                                   \r\n\r\n  Font: Arial 10pt body, Arial Bold 14/12pt headings                      \r\n  Margins: Narrow (0.5\" all sides) for more content                        \r\n  Layout: 2-column format for article body                                 \r\n  Spacing: 1.0 line spacing, 3pt after paragraphs                          \r\n  Colors: Accent color for headings, pull quotes                          \r\n  Images: Inline with text wrapping (square)                               \r\n  Use text boxes for callouts and sidebars                                 \r\n  Drop caps for article beginnings                                         \r\n\r\n\r\n\r\n  ACADEMIC ESSAYS / ASSIGNMENTS                                            \r\n\r\n  Font: Times New Roman 12pt throughout                                    \r\n  Margins: 1\" all sides (MLA/APA standard)                                 \r\n  Spacing: Double-spaced (2.0)                                             \r\n  Alignment: Left-aligned                                                  \r\n  Headers: Last name + page number (right)                                 \r\n  First page: Name, Professor, Course, Date (left, double-spaced)         \r\n  Title: Centered, no bold, same font size                                 \r\n  Citations: Hanging indent for works cited                                \r\n  No extra spacing between paragraphs                                      \r\n\r\n\r\n\r\n  TECHNICAL MANUALS / USER GUIDES                                          \r\n\r\n  Font: Verdana 10pt body (high readability), Verdana Bold 14/12pt heads  \r\n  Margins: Wide left margin (1.5\") for binding                            \r\n  Spacing: 1.15 line spacing                                               \r\n  Structure: Numbered sections with ToC                                     \r\n  Use tables for specifications and parameters                             \r\n  Screenshots/diagrams: Bordered, with numbered figure captions            \r\n  Headers: Chapter/section name                                            \r\n  Footer: Version number, revision date, page numbers                      \r\n  Warning/Note boxes with colored background (yellow/blue)                 \r\n  Step-by-step numbered lists for procedures                               \r\n\r\n\r\n\r\n  RESUMES / CVs                                                            \r\n\r\n  Font: Calibri 11pt body, Calibri 16/13pt headings                       \r\n  Margins: Moderate (0.75\" all sides) to fit content                       \r\n  Spacing: 1.0 line spacing, strategic spacing for sections               \r\n  Name: Large (18-20pt), bold, centered at top                             \r\n  Section headers: ALL CAPS or Bold with bottom border line                \r\n  Bullet points for achievements (not just responsibilities)               \r\n  No personal pronouns (I, me, my)                                         \r\n  Action verbs (Developed, Managed, Achieved)                              \r\n  Consistent date formats (MM/YYYY)                                        \r\n  Single page preferred (2 pages max for senior roles)                     \r\n\r\n\r\n\r\n TYPOGRAPHY HIERARCHY - STRICT SIZING RULES\r\n\r\n\r\nALWAYS maintain this precise hierarchy (sizes in points):\r\n\r\n\r\n DOCUMENT TITLE (Main Title)                                                 \r\n  Size: 18-20pt                                                             \r\n  Weight: Bold                                                              \r\n  Alignment: Center                                                         \r\n  Space After: 12pt                                                         \r\n  Example: \"Artificial Intelligence in Healthcare: 2024 Analysis\"          \r\n\r\n\r\n\r\n HEADING 1 (# in Markdown) - Major Sections                                 \r\n  Size: 16pt                                                                \r\n  Weight: Bold                                                              \r\n  Alignment: Left                                                           \r\n  Space Before: 12pt, Space After: 6pt                                      \r\n  Color: Black or Corporate color (#0078D4 for business)                   \r\n  Example: \"# Introduction\", \"# Methodology\", \"# Conclusion\"               \r\n\r\n\r\n\r\n HEADING 2 (## in Markdown) - Sub-sections                                  \r\n  Size: 14pt                                                                \r\n  Weight: Bold                                                              \r\n  Alignment: Left                                                           \r\n  Space Before: 10pt, Space After: 6pt                                      \r\n  Example: \"## Background\", \"## Current Trends\", \"## Key Findings\"         \r\n\r\n\r\n\r\n HEADING 3 (### in Markdown) - Sub-sub-sections                             \r\n  Size: 12pt                                                                \r\n  Weight: Bold                                                              \r\n  Alignment: Left                                                           \r\n  Space Before: 6pt, Space After: 3pt                                       \r\n  Example: \"### Market Analysis\", \"### Regional Breakdown\"                 \r\n\r\n\r\n\r\n BODY TEXT (Normal Paragraphs)                                               \r\n  Size: 11pt (default) or 12pt (academic/legal)                            \r\n  Weight: Regular (not bold)                                                \r\n  Alignment: Justify (formal docs) OR Left (standard docs)                 \r\n  Line Spacing: 1.15 (normal), 1.5 (reports), 2.0 (academic/legal)        \r\n  Space After: 6pt (normal), 0pt (academic double-spaced)                  \r\n  Use for: Explanations, descriptions, arguments, analysis                 \r\n\r\n\r\n\r\n EMPHASIZED TEXT                                                             \r\n  Use **bold** (same size as body): For key terms, important concepts      \r\n  Use *italic* (same size as body): For definitions, emphasis, quotes      \r\n  Use ***bold+italic***: For critical warnings or highlights               \r\n  NEVER randomly bold entire sentences - be strategic                      \r\n\r\n\r\n\r\n WHEN TO USE PARAGRAPHS vs BULLET POINTS - DECISION RULES\r\n\r\n\r\nCRITICAL: Choose the right format for readability and professionalism!\r\n\r\n USE PARAGRAPHS (Justified or Left-aligned) FOR:\r\n\r\n 1. Explanations & Analysis                                                 \r\n    \"The integration of AI in healthcare has transformed diagnostics...\"    \r\n                                                                             \r\n 2. Narrative & Storytelling                                                \r\n    \"In 2023, researchers at MIT developed a breakthrough algorithm...\"     \r\n                                                                             \r\n 3. Arguments & Reasoning                                                   \r\n    \"This approach offers several advantages. First, it reduces costs...\"   \r\n                                                                             \r\n 4. Background & Context                                                    \r\n    \"Historically, the field of AI emerged in the 1950s...\"                 \r\n                                                                             \r\n 5. Conclusions & Summaries (narrative style)                               \r\n    \"In conclusion, the evidence strongly suggests that...\"                 \r\n                                                                             \r\n 6. Legal/Academic Content (always paragraphs)                              \r\n    \"The parties agree that all intellectual property rights...\"            \r\n\r\n\r\n USE BULLET POINTS () FOR:\r\n\r\n 1. Lists of Items/Features                                                 \r\n     Cloud storage: 1TB                                                    \r\n     24/7 customer support                                                 \r\n     Advanced encryption                                                   \r\n                                                                             \r\n 2. Key Takeaways & Highlights                                              \r\n     Market grew 37% year-over-year                                        \r\n     AI adoption increased across all sectors                              \r\n     Investment reached $196 billion                                       \r\n                                                                             \r\n 3. Nested/Hierarchical Lists (use 2-space indent for sub-items)           \r\n     Main point one                                                        \r\n       Sub-point with detail                                               \r\n       Another sub-point                                                   \r\n         Even deeper detail                                                \r\n     Main point two                                                        \r\n       Sub-point under two                                                 \r\n                                                                             \r\n 4. Benefits/Advantages (short phrases)                                     \r\n     Reduces processing time by 70%                                        \r\n     Improves accuracy to 99.2%                                            \r\n     Cuts operational costs                                                \r\n                                                                             \r\n 5. Requirements/Specifications                                             \r\n     Windows 10 or higher                                                  \r\n     8GB RAM minimum                                                       \r\n     500GB storage space                                                   \r\n                                                                             \r\n MARKDOWN SYNTAX for nested bullets:                                        \r\n  Top level item (no indent)                                               \r\n    Second level (2 spaces)                                                \r\n      Third level (4 spaces)                                               \r\n\r\n\r\n USE NUMBERED LISTS (1., 2., 3.) FOR:\r\n\r\n 1. Sequential Steps/Procedures                                             \r\n    1. Open the application                                                 \r\n    2. Navigate to Settings                                                 \r\n    3. Click on Advanced Options                                            \r\n                                                                             \r\n 2. Ranked Items (priority order)                                           \r\n    1. Revenue growth (highest priority)                                    \r\n    2. Customer satisfaction                                                \r\n    3. Market expansion                                                     \r\n                                                                             \r\n 3. Hierarchical Numbering (use 2-space indent)                             \r\n    1. MAJOR SECTION                                                        \r\n      1.1 Sub-section                                                       \r\n        1.1.1 Specific detail                                               \r\n        1.1.2 Another detail                                                \r\n      1.2 Another sub-section                                               \r\n    2. NEXT MAJOR SECTION                                                   \r\n                                                                             \r\n 4. Chronological Events                                                    \r\n    1. 2020: Initial research phase                                         \r\n    2. 2022: Prototype development                                          \r\n    3. 2024: Commercial launch                                              \r\n                                                                             \r\n MARKDOWN SYNTAX for nested numbering:                                      \r\n 1. Top level                                                               \r\n   1.1 Second level (2 spaces)                                              \r\n     1.1.1 Third level (4 spaces)                                           \r\n\r\n\r\n GOLDEN RULE: \r\n If it reads like a sentence  Use paragraphs (justified for formal)\r\n If it's a list of things  Use bullet points\r\n If order matters  Use numbered list\r\n\r\n\r\n TABLES & BORDERS - WHEN AND HOW TO USE\r\n\r\n\r\nACTIVELY look for opportunities to use tables! They improve readability dramatically.\r\n\r\n USE TABLES FOR:\r\n\r\n 1. Comparisons (2+ options)                                                \r\n    | Feature | Product A | Product B | Product C |                        \r\n    |---------|-----------|-----------|-----------|                        \r\n    | Price   | $99       | $149      | $199      |                        \r\n    | Storage | 100GB     | 500GB     | 1TB       |                        \r\n                                                                             \r\n 2. Data Presentation (statistics, metrics)                                 \r\n    | Year | Revenue | Growth % |                                          \r\n    |------|---------|----------|                                          \r\n    | 2022 | $10M    | 25%      |                                          \r\n    | 2023 | $15M    | 50%      |                                          \r\n                                                                             \r\n 3. Specifications & Parameters                                             \r\n    | Component | Specification |                                          \r\n    |-----------|---------------|                                          \r\n    | CPU       | Intel i7      |                                          \r\n    | RAM       | 16GB DDR4     |                                          \r\n                                                                             \r\n 4. Schedules & Timelines                                                   \r\n    | Phase | Duration | Deliverables |                                    \r\n    |-------|----------|--------------|                                    \r\n    | 1     | 3 months | Research     |                                    \r\n    | 2     | 6 months | Development  |                                    \r\n                                                                             \r\n 5. Pros & Cons Side-by-Side                                                \r\n    | Advantages | Disadvantages |                                         \r\n    |------------|---------------|                                         \r\n    | Fast       | Expensive     |                                         \r\n    | Reliable   | Complex       |                                         \r\n\r\n\r\nTABLE FORMATTING RULES:\r\n Header Row: Always bold, can use light background shading\r\n Borders: Use pipe | and dashes - in Markdown (Word will render properly)\r\n Alignment: Numbers right-aligned, text left-aligned\r\n Consistency: Same format throughout document\r\n\r\n\r\n INDENTATION & ALIGNMENT RULES\r\n\r\n\r\nINDENTATION HIERARCHY - CRITICAL FOR READABILITY:\r\n\r\n\r\n PARAGRAPHS (No Indentation for Modern Docs)                                \r\n  First paragraph after heading: NO indent (flush left)                    \r\n  Subsequent paragraphs: NO indent (use spacing instead)                   \r\n  Modern style: Space between paragraphs, no first-line indent             \r\n                                                                             \r\n EXCEPTION - Academic/Traditional Documents:                                \r\n  First line indent: 0.5 inches (36pt) for each paragraph                  \r\n  NO space between paragraphs                                               \r\n  Used in: MLA essays, traditional books, formal reports                   \r\n\r\n\r\n\r\n BULLET LISTS (Progressive Indentation)                                     \r\n  Level 1 (main points): 0.25\" indent (18pt)                               \r\n    Level 2 (sub-points): 0.5\" indent (36pt)                               \r\n      Level 3 (details): 0.75\" indent (54pt)                               \r\n                                                                             \r\n Example Structure:                                                          \r\n  Main benefit one                                                          \r\n    Supporting detail                                                       \r\n    Another detail                                                          \r\n  Main benefit two                                                          \r\n    Supporting detail                                                       \r\n      Specific example                                                      \r\n      Another example                                                       \r\n\r\n\r\n\r\n NUMBERED LISTS (Hierarchical Numbering)                                    \r\n 1. First level (0.25\" indent)                                              \r\n    1.1 Second level (0.5\" indent)                                          \r\n        1.1.1 Third level (0.75\" indent)                                    \r\n                                                                             \r\n Legal/Formal Documents:                                                    \r\n 1. MAJOR SECTION                                                           \r\n    1.1 Sub-section                                                         \r\n        1.1.1 Specific provision                                            \r\n        1.1.2 Another provision                                             \r\n    1.2 Another sub-section                                                 \r\n 2. NEXT MAJOR SECTION                                                      \r\n\r\n\r\n\r\n BLOCK QUOTES (Indentation for Emphasis)                                    \r\n  Left indent: 0.5\" (36pt)                                                 \r\n  Right indent: 0.5\" (36pt)                                                \r\n  Italic or different font color optional                                  \r\n  Use for: Citations, important quotes, callouts                           \r\n                                                                             \r\n Example:                                                                    \r\n     \"AI will transform healthcare in ways we cannot yet imagine,           \r\n     bringing precision medicine to every patient worldwide.\"               \r\n      Dr. Jane Smith, Stanford University                                  \r\n\r\n\r\n\r\n SPECIAL FORMATTING                                                         \r\n                                                                             \r\n Hanging Indent (Citations/References):                                     \r\n  First line: Flush left (0\")                                              \r\n  Subsequent lines: 0.5\" indent (36pt)                                     \r\n  Use for: Bibliography, works cited, references                           \r\n                                                                             \r\n Example:                                                                    \r\n Smith, J. (2024). Artificial Intelligence in Modern Healthcare.            \r\n     Journal of Medical Technology, 45(3), 234-256.                         \r\n                                                                             \r\n Code Blocks (Monospace + Indent):                                          \r\n  Left indent: 0.5\" (36pt)                                                 \r\n  Font: Courier New or Consolas                                            \r\n  Background: Light gray (#F5F5F5)                                         \r\n  Use for: Code examples, technical specifications                         \r\n\r\n\r\nALIGNMENT RULES - BE CONSISTENT:\r\n\r\n\r\n ALWAYS JUSTIFY for:                                                        \r\n  Technical reports (formal)                                                \r\n  Research papers                                                           \r\n  Legal documents                                                           \r\n  Business proposals (body text)                                            \r\n  Academic essays (sometimes)                                               \r\n                                                                             \r\n Reason: Professional, publication-quality appearance                        \r\n\r\n\r\n\r\n USE LEFT ALIGNMENT for:                                                    \r\n  Casual documents                                                          \r\n  Newsletters                                                               \r\n  Emails/memos                                                              \r\n  Bullet point lists (always)                                               \r\n  Headings (always)                                                         \r\n  Modern business docs (if specifically requested)                          \r\n                                                                             \r\n Reason: Easier to read, modern look                                         \r\n\r\n\r\n\r\n USE CENTER ALIGNMENT for:                                                  \r\n  Document title (main title only)                                          \r\n  Cover page elements                                                       \r\n  Standalone quotes/callouts                                                \r\n  Image captions (optional)                                                 \r\n                                                                             \r\n NEVER center: Regular paragraphs, headings, body text                       \r\n\r\n\r\n\r\n INTELLIGENT CONTENT GENERATION\r\n\r\n\r\nWhen generating content, USE YOUR KNOWLEDGE to provide:\r\n\r\n SPECIFIC DATA: Real statistics, dates, facts (e.g., \"In 2023, AI market reached $196B\")\r\n EXAMPLES: Concrete instances, case studies, scenarios\r\n COMPARISONS: Tables comparing options, pros/cons lists (USE TABLES!)\r\n STRUCTURED ARGUMENTS: Introduction  Body  Conclusion flow\r\n AUTHORITATIVE TONE: Confident, well-researched, professional\r\n CITATIONS: Where appropriate, mention sources (even if general)\r\n VISUAL HIERARCHY: Strategic use of headings, subheadings, lists, tables\r\n\r\nCONTENT DENSITY:\r\n Short requests (1-2 sentences): Generate 200-400 words minimum\r\n Reports/essays: 800-1500 words with proper structure\r\n Executive summaries: 300-500 words, high-density information\r\n Technical docs: Comprehensive coverage with examples\r\n\r\nSTRUCTURE CONSCIOUSNESS:\r\n Start with main title (18-20pt, centered)\r\n Use heading hierarchy (# 16pt  ## 14pt  ### 12pt)\r\n Body paragraphs: 11-12pt, justified for formal docs\r\n Insert tables wherever comparing 2+ items\r\n Use bullet points for lists, NOT for paragraphs\r\n Maintain consistent spacing throughout\r\n\r\n\r\n DECISION MATRIX - CHOOSE THE RIGHT ACTION TYPE\r\n\r\n\r\n\r\n USER REQUEST                 ACTION TYPE TO USE                               \r\n\r\n \"Write a report on X\"        type: \"insert\" + content + formatting            \r\n \"Make this formal\"           type: \"replace\" + reformatted content            \r\n \"Summarize this\"             type: \"replace\" + summarized content             \r\n \"Add a header\"               type: \"command\", commandName: \"updateHeader\"     \r\n \"Fix the margins\"            type: \"command\", commandName: \"setMargins\"       \r\n \"Format as report\"           type: \"multi-command\" with multiple commands     \r\n \"Make this bold\"             type: \"format\" + formatting object               \r\n \"What is X?\"                 type: \"chat\" + informational response            \r\n \"Fix all headings\"           type: \"command\", commandName: \"fixHeadings\"      \r\n \"Make it professional\"       type: \"multi-command\" (theme + fonts + spacing)  \r\n                                                                               \r\n BORDER COMMANDS:                                                              \r\n \"Add a border\"               type: \"command\", commandName: \"addBorder\"        \r\n \"Add page border\"            type: \"command\", commandName: \"addPageBorder\"    \r\n \"Red border\"                 type: \"command\", commandName: \"addBorder\"        \r\n                              args: { color: \"#FF0000\" }                       \r\n \"Thick border\"               type: \"command\", commandName: \"addBorder\"        \r\n                              args: { width: 6 }                               \r\n \"Double border\"              type: \"command\", commandName: \"addBorder\"        \r\n                              args: { style: \"double\" }                        \r\n \"Wavy/curly border\"          type: \"command\", commandName: \"addBorder\"        \r\n                              args: { style: \"wave\" }                          \r\n \"Border around this\"         type: \"command\", commandName: \"addBorder\"        \r\n \"Decorative box\"             type: \"command\", commandName:                    \r\n                              \"addDecorativeBorder\"                            \r\n \"Border on all pages\"        type: \"command\", commandName: \"addPageBorder\"    \r\n                              args: { applyToAllPages: true }                  \r\n \"Remove border\"              type: \"command\", commandName: \"removeBorders\"    \r\n \"Colorful border\"            type: \"command\", commandName: \"addBorder\"        \r\n                              args: { color: \"#0078D4\", width: 3 }             \r\n \"Border on selected text\"    type: \"command\", commandName: \"addBorder\"        \r\n \"Border on one page\"         type: \"command\", commandName: \"addPageBorder\"    \r\n                              args: { applyToAllPages: false }                 \r\n\r\n\r\n\r\n JSON OUTPUT SPECIFICATION\r\n\r\n\r\nReturn ONLY a valid JSON object. NO markdown code blocks. NO extra text.\r\n\r\n**CRITICAL JSON RULES:**\r\n1. Escape ALL newlines as \\\\n in string values\r\n2. Escape ALL double quotes as \\\\\" inside strings\r\n3. NO actual newline characters inside JSON strings\r\n4. Use \\\\t for tabs if needed\r\n\r\n**CRITICAL FORMATTING RULE:**\r\nWhen your content includes MULTIPLE heading levels (# ## ###), DO NOT set a global fontSize \r\nin the formatting object. Let the Markdown parser handle sizing based on heading levels.\r\nONLY set fontSize if you want ALL text to be the same size (rare).\r\n\r\nSTRUCTURE:\r\n{\r\n  \"chatResponse\": \"Brief, friendly confirmation (1 sentence)\",\r\n  \"action\": {\r\n    \"type\": \"replace\" | \"format\" | \"insert\" | \"chat\" | \"command\" | \"multi-command\",\r\n    \"target\": \"selection\" | \"document\",\r\n    \"content\": \"Full content with \\\\n for newlines. Use Markdown: # headers, **bold**, *italic*, tables, lists\",\r\n    \"formatting\": {\r\n      \"fontName\": \"Calibri\" | \"Arial\" | \"Georgia\" | \"Times New Roman\" | \"Verdana\",\r\n      \"fontSize\": 11 | 12,  //  ONLY set this if ALL text should be same size. OMIT for varied heading sizes!\r\n      \"bold\": false,\r\n      \"italic\": false,\r\n      \"underline\": false,\r\n      \"color\": \"black\" | \"#0078D4\" | \"#FF0000\" | \"rgb(0,0,0)\",\r\n      \"alignment\": \"left\" | \"center\" | \"right\" | \"justify\",\r\n      \"lineSpacing\": 1.0 | 1.15 | 1.5 | 2.0,\r\n      \"spaceAfter\": 0 | 6 | 8 | 10 | 12,\r\n      \"spaceBefore\": 0 | 6 | 8 | 10 | 12\r\n    },\r\n    \"commandName\": \"fixHeadings\" | \"normalizeFonts\" | \"setMargins\" | \"formatImages\" | \r\n                   \"updateHeader\" | \"updateFooter\" | \"applyBulletList\" | \"applyNumberedList\" |\r\n                   \"clearFormatting\" | \"autoFormat\",\r\n    \"args\": {\r\n      // For updateHeader:\r\n      { \"leftText\": \"Document Title\", \"rightText\": \"Author Name\" }\r\n      \r\n      // For updateFooter:\r\n      { \"leftText\": \"Confidential\", \"centerText\": \"\", \"rightText\": \"\", \"addPageNumbers\": true }\r\n      \r\n      // For setMargins:\r\n      { \"top\": 72, \"bottom\": 72, \"left\": 72, \"right\": 72 }  // in points (72pt = 1 inch)\r\n      \r\n      // For normalizeFonts:\r\n      { \"fontName\": \"Calibri\", \"fontSize\": 11 }\r\n      \r\n      // For formatImages:\r\n      { \"alignment\": \"centered\", \"padding\": 0, \"addCaptions\": true }\r\n    },\r\n    \"multiCommands\": [\r\n      { \"commandName\": \"fixHeadings\", \"args\": {} },\r\n      { \"commandName\": \"normalizeFonts\", \"args\": { \"fontName\": \"Calibri\", \"fontSize\": 11 } },\r\n      { \"commandName\": \"setMargins\", \"args\": { \"top\": 72, \"bottom\": 72, \"left\": 72, \"right\": 72 } }\r\n    ]\r\n  }\r\n}\r\n\r\n\r\n PERFECT DOCUMENT STRUCTURE EXAMPLE\r\n\r\n\r\nMANDATORY FORMATTING PATTERN (follow this exactly):\r\n\r\nDOCUMENT TITLE\r\n   20pt, Bold, Centered, Space After: 12pt\r\n   Example: \"Artificial Intelligence in Healthcare: 2024 Analysis\"\r\n\r\n# HEADING 1 (Major Sections)\r\n   16pt, Bold, Left-aligned, Space Before: 12pt, After: 6pt\r\n   Use for: Introduction, Methodology, Results, Conclusion\r\n\r\nBODY PARAGRAPHS (after headings)\r\n   11pt, Regular (not bold), Justified alignment\r\n   Line Spacing: 1.5, Space After: 6pt\r\n   Use for: Explanations, analysis, arguments, descriptions\r\n   Example: \"Artificial Intelligence (AI) has emerged as a transformative force...\"\r\n\r\n## HEADING 2 (Sub-sections)\r\n   14pt, Bold, Left-aligned, Space Before: 10pt, After: 6pt\r\n   Use for: Sub-topics within major sections\r\n\r\n### HEADING 3 (Sub-sub-sections)\r\n   12pt, Bold, Left-aligned, Space Before: 6pt, After: 3pt\r\n   Use for: Detailed breakdowns\r\n\r\nBULLET LISTS (for items, not paragraphs)\r\n   11pt, Regular, Left-aligned\r\n   Level 1: Base indent (18pt)\r\n   Level 2: +18pt additional indent (use 2 spaces in markdown: \"  \")\r\n   Level 3: +36pt additional indent (use 4 spaces in markdown: \"    \")\r\n   Use ONLY for: Features, benefits, requirements, specifications\r\n   Example with nesting:\r\n     Main benefit one\r\n       Supporting detail\r\n       Another detail\r\n     Main benefit two\r\n       Sub-point here\r\n\r\nNUMBERED LISTS (for steps or ranked items)\r\n   11pt, Regular, Left-aligned\r\n   Level 1: Base indent (18pt)\r\n   Level 2: +18pt indent (use 2 spaces: \"  1.\")\r\n   Hierarchical: 1.  1.1  1.1.1\r\n   Use for: Procedures, chronological events, priority lists\r\n   Example with hierarchy:\r\n    1. First major step\r\n      1.1 Sub-step detail\r\n        1.1.1 Specific action\r\n      1.2 Another sub-step\r\n    2. Second major step\r\n\r\nTABLES (for comparisons and data)\r\n   Always use | pipes and --- dashes for Markdown tables\r\n   Header row: Bold\r\n   Use for: Comparing 2+ items, data presentation, specifications\r\n   Example:\r\n    | Feature | Option A | Option B |\r\n    |---------|----------|----------|\r\n    | Price   | $99      | $149     |\r\n    | Storage | 100GB    | 500GB    |\r\n\r\nBOLD TEXT (strategic emphasis)\r\n   Same size as surrounding text\r\n   Use for: **Key terms**, **important concepts**, **critical data**\r\n   NEVER bold entire sentences or paragraphs\r\n\r\n\r\n SIZING QUICK REFERENCE\r\n\r\n\r\nTitle:     20pt, Bold, Centered\r\n# H1:      16pt, Bold, Left\r\n## H2:     14pt, Bold, Left\r\n### H3:    12pt, Bold, Left\r\nBody:      11pt, Regular, Justified (or 12pt for academic/legal)\r\nLists:     11pt, Regular, Left\r\nTables:    11pt, Regular, borders visible\r\n\r\n\r\n RESPONSE EXAMPLES (JSON Format)\r\n\r\n\r\nExample 1 - Complex Report Generation:\r\n{\r\n  \"chatResponse\": \"I've created a comprehensive technical report on AI in healthcare with proper typography and structure.\",\r\n  \"action\": {\r\n    \"type\": \"insert\",\r\n    \"target\": \"document\",\r\n    \"content\": \"Artificial Intelligence in Healthcare: 2024 Analysis\\\\n\\\\n# Introduction\\\\n\\\\nArtificial Intelligence (AI) has emerged as a transformative force in modern healthcare, revolutionizing diagnostics, treatment planning, and patient care. The global AI healthcare market reached $19.8 billion in 2024, with projections indicating growth to $187.95 billion by 2030, representing a compound annual growth rate (CAGR) of 42.3%.\\\\n\\\\nThe integration of machine learning algorithms has enabled healthcare providers to achieve unprecedented accuracy in disease detection. This report examines current applications and future directions.\\\\n\\\\n## Current Applications\\\\n\\\\n### Medical Imaging\\\\n\\\\nAI-powered imaging systems now detect conditions with **95%+ accuracy**, surpassing human performance in specific tasks. Deep learning models analyze medical scans to identify:\\\\n\\\\n Early-stage cancers (lung, breast, skin)\\\\n Cardiovascular abnormalities\\\\n Neurological disorders\\\\n Fractures and bone density issues\\\\n\\\\n### Performance Comparison\\\\n\\\\n| Metric | Traditional | AI-Assisted | Improvement |\\\\n|--------|-------------|-------------|-------------|\\\\n| Accuracy | 87% | 95% | +8% |\\\\n| Time | 15 min | 3 min | -80% |\\\\n| Cost | $200 | $50 | -75% |\\\\n\\\\n## Key Benefits\\\\n\\\\nThe adoption of AI in healthcare delivers measurable advantages:\\\\n\\\\n **Improved Accuracy**: 40-60% reduction in diagnostic errors\\\\n **Faster Processing**: Analysis time from hours to minutes\\\\n **Cost Efficiency**: 30-50% operational savings\\\\n **24/7 Availability**: Continuous monitoring capability\\\\n **Personalized Treatment**: Tailored patient recommendations\\\\n\\\\n# Conclusion\\\\n\\\\nThe transformation of healthcare through AI represents a paradigm shift in medical practice. With continued investment and ethical oversight, AI will become indispensable in delivering superior patient outcomes while reducing costs and improving accessibility.\",\r\n    \"formatting\": {\r\n      \"fontName\": \"Georgia\",\r\n      \"alignment\": \"justify\",\r\n      \"lineSpacing\": 1.5,\r\n      \"spaceAfter\": 6\r\n    }\r\n  }\r\n}\r\n\r\nNOTE: fontSize is NOT set in formatting above because the content has multiple heading levels.\r\nThe Markdown parser will automatically apply: # = 16pt, ## = 14pt, ### = 12pt, body = inherited (11-12pt from base style).\r\n\r\nExample 2 - Professional Document Formatting:\r\n{\r\n  \"chatResponse\": \"I've applied professional business formatting to your document.\",\r\n  \"action\": {\r\n    \"type\": \"multi-command\",\r\n    \"multiCommands\": [\r\n      { \"commandName\": \"fixHeadings\" },\r\n      { \"commandName\": \"normalizeFonts\", \"args\": { \"fontName\": \"Calibri\", \"fontSize\": 11 } },\r\n      { \"commandName\": \"setMargins\", \"args\": { \"top\": 72, \"bottom\": 72, \"left\": 54, \"right\": 54 } },\r\n      { \"commandName\": \"updateHeader\", \"args\": { \"leftText\": \"\", \"rightText\": \"Q4 2024 Report\" } },\r\n      { \"commandName\": \"updateFooter\", \"args\": { \"leftText\": \"Confidential\", \"centerText\": \"\", \"rightText\": \"\", \"addPageNumbers\": true } }\r\n    ]\r\n  }\r\n}\r\n\r\n\r\n FINAL DIRECTIVES\r\n\r\n\r\n1. **BE PROACTIVE**: If user says \"write a report\", don't just write content - also suggest/apply proper formatting\r\n2. **BE COMPLETE**: No placeholders. Real content. Real data. Real insights.\r\n3. **BE SMART**: Auto-detect document type and apply appropriate professional standards\r\n4. **BE PRECISE**: Follow JSON schema exactly. Escape special characters properly.\r\n5. **BE PROFESSIONAL**: Publication-quality output. Engineering-level documentation standards.\r\n6. **BE CREATIVE**: Use tables, lists, headings strategically. Make content scannable and engaging.\r\n\r\nNOW PROCESS THE USER'S REQUEST AND GENERATE YOUR RESPONSE.\r\n`;\r\n\r\n    const response = await ai.models.generateContent({\r\n      model,\r\n      contents: systemPrompt,\r\n      config: {\r\n        responseMimeType: \"application/json\",\r\n      }\r\n    });\r\n\r\n    if (!response.text) {\r\n      throw new Error(\"No response from Gemini AI\");\r\n    }\r\n\r\n    // Robust JSON Parsing\r\n    let cleanText = response.text.trim();\r\n\r\n    // Remove markdown code blocks if present (common issue)\r\n    cleanText = cleanText.replace(/^```json\\s*/i, '').replace(/^```\\s*/i, '').replace(/\\s*```$/, '');\r\n\r\n    // Attempt to find the first '{' and last '}' to handle potential extra text\r\n    const firstBrace = cleanText.indexOf('{');\r\n    const lastBrace = cleanText.lastIndexOf('}');\r\n\r\n    if (firstBrace !== -1 && lastBrace !== -1) {\r\n      cleanText = cleanText.substring(firstBrace, lastBrace + 1);\r\n    }\r\n\r\n    try {\r\n      const parsed = JSON.parse(cleanText);\r\n\r\n      // Handle Array Response (Merge actions)\r\n      if (Array.isArray(parsed)) {\r\n        console.log(\"Received JSON Array response, merging...\", parsed);\r\n\r\n        let mergedResponse: AIResponse = {\r\n          chatResponse: \"\",\r\n          action: { type: 'multi-command', multiCommands: [] }\r\n        };\r\n\r\n        const actions: any[] = [];\r\n\r\n        parsed.forEach((item: any) => {\r\n          // Use the first chat response found\r\n          if (item.chatResponse && !mergedResponse.chatResponse) {\r\n            mergedResponse.chatResponse = item.chatResponse;\r\n          }\r\n\r\n          if (item.action) {\r\n            actions.push(item.action);\r\n          }\r\n        });\r\n\r\n        // If we have a single action, just use it\r\n        if (actions.length === 1) {\r\n          mergedResponse.action = actions[0];\r\n        }\r\n        // If we have multiple actions, convert to multi-command or keep as is if it's already one\r\n        else if (actions.length > 1) {\r\n          // Check if we can merge into multi-command\r\n          const multiCommands: any[] = [];\r\n\r\n          actions.forEach(action => {\r\n            if (action.type === 'command') {\r\n              multiCommands.push({\r\n                commandName: action.commandName,\r\n                args: action.args\r\n              });\r\n            } else if (action.type === 'multi-command' && action.multiCommands) {\r\n              multiCommands.push(...action.multiCommands);\r\n            } else {\r\n              // For non-command actions (like replace/insert), we can't easily merge into multi-command\r\n              // In this case, we prioritize the last \"content\" action or just the first action\r\n              // This is a fallback. Ideally, the AI should return a single multi-command.\r\n              console.warn(\"Cannot merge non-command action into multi-command:\", action);\r\n            }\r\n          });\r\n\r\n          if (multiCommands.length > 0) {\r\n            mergedResponse.action = {\r\n              type: 'multi-command',\r\n              multiCommands: multiCommands\r\n            };\r\n          } else {\r\n            // Fallback: just use the last action if we couldn't merge\r\n            mergedResponse.action = actions[actions.length - 1];\r\n          }\r\n        }\r\n\r\n        return mergedResponse;\r\n      }\r\n\r\n      return parsed as AIResponse;\r\n    } catch (parseError) {\r\n      console.warn(\"Initial JSON Parse Failed. Attempting repair...\", parseError);\r\n\r\n      try {\r\n        // Attempt to repair common JSON errors\r\n        // 1. Escape unescaped newlines within strings\r\n        // This regex looks for newlines that are NOT followed by a quote and a comma/brace, \r\n        // which usually indicates a new property or end of object.\r\n        // It's a heuristic and not perfect.\r\n        const repairedText = cleanText.replace(/\\n/g, \"\\\\n\");\r\n        return JSON.parse(repairedText) as AIResponse;\r\n      } catch (repairError) {\r\n        console.warn(\"JSON Repair Failed. Raw text:\", response.text);\r\n        // Fallback: Treat the entire response as a chat message\r\n        return {\r\n          chatResponse: response.text, // Return raw text so user sees something\r\n          action: { type: 'chat' }\r\n        };\r\n      }\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error(\" Gemini API error:\", error);\r\n    return {\r\n      chatResponse: \"I'm sorry, I encountered an issue connecting to the AI. Please check your internet connection or API key.\",\r\n      action: { type: 'chat' }\r\n    };\r\n  }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\markdownParser.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'line' is never reassigned. Use 'const' instead.","line":21,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":21,"endColumn":17,"fix":{"range":[605,625],"text":"const line = lines[i];"}},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\*.","line":85,"column":30,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":31,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3382,3383],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3382,3382],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\+.","line":85,"column":34,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":35,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3386,3387],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3386,3386],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\*.","line":92,"column":48,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":92,"endColumn":49,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3662,3663],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3662,3662],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\+.","line":92,"column":52,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":92,"endColumn":53,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3666,3667],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3666,3666],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\*.","line":117,"column":30,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":117,"endColumn":31,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4421,4422],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4421,4421],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\+.","line":117,"column":34,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":117,"endColumn":35,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4425,4426],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4425,4425],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\*.","line":124,"column":48,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":124,"endColumn":49,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4711,4712],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4711,4711],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\+.","line":124,"column":52,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":124,"endColumn":53,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4715,4716],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4715,4715],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\r\n * Simple Markdown to HTML parser for Word Add-in\r\n * Converts basic Markdown syntax to HTML that Word can interpret.\r\n */\r\n\r\n/**\r\n * Simple Markdown to HTML parser for Word Add-in\r\n * Converts basic Markdown syntax to HTML that Word can interpret.\r\n */\r\nexport const parseMarkdownToHtml = (markdown: string): string => {\r\n    if (!markdown) return '';\r\n\r\n    const lines = markdown.split('\\n');\r\n    let html = '';\r\n    let inList = false;\r\n    let listType = ''; // 'ul' or 'ol'\r\n    let inTable = false;\r\n    let tableHeaderParsed = false;\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n        let line = lines[i];\r\n\r\n        // Check for empty lines\r\n        if (line.trim() === '') {\r\n            if (inList) {\r\n                html += `</${listType}>`;\r\n                inList = false;\r\n            }\r\n            if (inTable) {\r\n                html += '</tbody></table>';\r\n                inTable = false;\r\n                tableHeaderParsed = false;\r\n            }\r\n            continue;\r\n        }\r\n\r\n        // Table Detection\r\n        if (line.trim().startsWith('|')) {\r\n            if (!inTable) {\r\n                // Check if it's a valid table start (next line should be separator)\r\n                if (i + 1 < lines.length && lines[i + 1].trim().startsWith('|') && lines[i + 1].includes('---')) {\r\n                    html += '<table border=\"1\" style=\"border-collapse: collapse; width: 100%;\"><thead><tr>';\r\n                    const headers = line.split('|').filter(cell => cell.trim() !== '');\r\n                    headers.forEach(header => {\r\n                        html += `<th style=\"padding: 8px; border: 1px solid #000000; background-color: #f2f2f2; font-weight: bold;\">${parseInline(header.trim())}</th>`;\r\n                    });\r\n                    html += '</tr></thead><tbody>';\r\n                    inTable = true;\r\n                    tableHeaderParsed = true;\r\n                    i++; // Skip the separator line\r\n                    continue;\r\n                }\r\n            } else if (tableHeaderParsed) {\r\n                // Table Row\r\n                if (line.includes('---')) continue; // Skip separator if encountered again\r\n                html += '<tr>';\r\n                // Better split: split by |, then ignore first and last if empty?\r\n                // Standard markdown tables have leading/trailing pipes often.\r\n                // Let's use a regex or cleaner split.\r\n                const rowContent = line.trim().replace(/^\\||\\|$/g, '');\r\n                const rowCells = rowContent.split('|');\r\n\r\n                rowCells.forEach(cell => {\r\n                    html += `<td style=\"padding: 8px; border: 1px solid #000000;\">${parseInline(cell.trim())}</td>`;\r\n                });\r\n                html += '</tr>';\r\n                continue;\r\n            }\r\n        } else if (inTable) {\r\n            html += '</tbody></table>';\r\n            inTable = false;\r\n            tableHeaderParsed = false;\r\n        }\r\n\r\n        // Headers\r\n        if (line.match(/^#{1,6} /)) {\r\n            if (inList) { html += `</${listType}>`; inList = false; }\r\n            const level = line.match(/^#{1,6}/)![0].length;\r\n            const content = line.replace(/^#{1,6} /, '');\r\n            html += `<h${level}>${parseInline(content)}</h${level}>`;\r\n            continue;\r\n        }\r\n\r\n        // Unordered List\r\n        if (line.match(/^\\s*[\\*\\-\\+] /)) {\r\n            if (!inList || listType === 'ol') {\r\n                if (inList) html += `</${listType}>`;\r\n                html += '<ul>';\r\n                inList = true;\r\n                listType = 'ul';\r\n            }\r\n            const content = line.replace(/^\\s*[\\*\\-\\+] /, '');\r\n            html += `<li>${parseInline(content)}</li>`;\r\n            continue;\r\n        }\r\n\r\n        // Ordered List\r\n        if (line.match(/^\\s*\\d+\\. /)) {\r\n            if (!inList || listType === 'ul') {\r\n                if (inList) html += `</${listType}>`;\r\n                html += '<ol>';\r\n                inList = true;\r\n                listType = 'ol';\r\n            }\r\n            const content = line.replace(/^\\s*\\d+\\. /, '');\r\n            html += `<li>${parseInline(content)}</li>`;\r\n            continue;\r\n        }\r\n\r\n        // Close list if we encounter a non-list line\r\n        if (inList) {\r\n            html += `</${listType}>`;\r\n            inList = false;\r\n        }\r\n\r\n        // Paragraphs\r\n        if (line.match(/^\\s*[\\*\\-\\+][A-Za-z0-9]/)) {\r\n            if (!inList || listType === 'ol') {\r\n                if (inList) html += `</${listType}>`;\r\n                html += '<ul>';\r\n                inList = true;\r\n                listType = 'ul';\r\n            }\r\n            const content = line.replace(/^\\s*[\\*\\-\\+]/, '');\r\n            html += `<li>${parseInline(content)}</li>`;\r\n            continue;\r\n        }\r\n\r\n        html += `<p>${parseInline(line)}</p>`;\r\n    }\r\n\r\n    if (inList) {\r\n        html += `</${listType}>`;\r\n    }\r\n    if (inTable) {\r\n        html += '</tbody></table>';\r\n    }\r\n\r\n    return html;\r\n};\r\n\r\n// Export the old name for compatibility if needed, but we replaced the implementation.\r\nexport const markdownToHtml = parseMarkdownToHtml;\r\n\r\nconst parseInline = (text: string): string => {\r\n    let html = text;\r\n\r\n    // Bold *** or ___\r\n    // Use [\\s\\S] to match newlines if they somehow exist, though we split by line.\r\n    html = html.replace(/\\*\\*\\*([\\s\\S]*?)\\*\\*\\*/g, '<span style=\"font-weight:bold;font-style:italic;\">$1</span>');\r\n    html = html.replace(/___([\\s\\S]*?)___/g, '<span style=\"font-weight:bold;font-style:italic;\">$1</span>');\r\n\r\n    // Bold ** or __\r\n    html = html.replace(/\\*\\*([\\s\\S]*?)\\*\\*/g, '<span style=\"font-weight:bold;\">$1</span>');\r\n    html = html.replace(/__([\\s\\S]*?)__/g, '<span style=\"font-weight:bold;\">$1</span>');\r\n\r\n    // Italic * or _\r\n    // We want to match *word* or *word.* or * word *\r\n    // The previous regex \\*(.*?)\\* was correct for non-greedy matching.\r\n    // Let's ensure we handle cases where * is part of the text? No, markdown assumes * is formatting.\r\n    html = html.replace(/\\*([\\s\\S]*?)\\*/g, '<span style=\"font-style:italic;\">$1</span>');\r\n    html = html.replace(/_([\\s\\S]*?)_/g, '<span style=\"font-style:italic;\">$1</span>');\r\n\r\n    // Code `\r\n    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');\r\n\r\n    return html;\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\oauth-redirect.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\testFormatting.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\testStyles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\src\\utils\\wordUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":415,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":415,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13584,13587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13584,13587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* global Word */\r\n\r\n/**\r\n * Insert text at the current cursor position\r\n */\r\nexport const insertTextAtCursor = async (text: string): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    range.insertText(text, Word.InsertLocation.end);\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Insert HTML at the current cursor position\r\n */\r\nexport const insertHtmlAtCursor = async (html: string): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    range.insertHtml(html, Word.InsertLocation.end);\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Replace the currently selected text\r\n */\r\nexport const replaceSelectedText = async (text: string): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    range.insertText(text, Word.InsertLocation.replace);\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Replace the currently selected text with HTML\r\n */\r\nexport const replaceSelectedTextWithHtml = async (html: string): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n\r\n    // Get the start of the selection to determine the \"base\" formatting\r\n    const startRange = range.getRange(Word.RangeLocation.start);\r\n    startRange.load('font');\r\n    await context.sync();\r\n\r\n    const fontName = startRange.font.name;\r\n    const fontSize = startRange.font.size;\r\n\r\n    // Insert the HTML\r\n    range.insertHtml(html, Word.InsertLocation.replace);\r\n\r\n    // Re-apply the base font settings to the inserted content\r\n    if (fontName) range.font.name = fontName;\r\n    if (fontSize) range.font.size = fontSize;\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Get the currently selected text\r\n */\r\nexport const getSelectedText = async (): Promise<string> => {\r\n  return await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    range.load('text');\r\n    await context.sync();\r\n    return range.text;\r\n  });\r\n};\r\n\r\n/**\r\n * Apply paragraph formatting to selection\r\n */\r\nexport const applyParagraphFormatting = async (options: {\r\n  fontName?: string;\r\n  fontSize?: number;\r\n  bold?: boolean;\r\n  italic?: boolean;\r\n  underline?: boolean;\r\n  alignment?: Word.Alignment;\r\n  lineSpacing?: number;\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    const font = range.font;\r\n\r\n    if (options.fontName) font.name = options.fontName;\r\n    if (options.fontSize) font.size = options.fontSize;\r\n    if (options.bold !== undefined) font.bold = options.bold;\r\n    if (options.italic !== undefined) font.italic = options.italic;\r\n    if (options.underline !== undefined) {\r\n      font.underline = options.underline ? Word.UnderlineType.single : Word.UnderlineType.none;\r\n    }\r\n\r\n    const paragraph = range.paragraphs.getFirst();\r\n    if (options.alignment) paragraph.alignment = options.alignment;\r\n    if (options.lineSpacing) paragraph.lineSpacing = options.lineSpacing;\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Set document margins\r\n */\r\nexport const setDocumentMargins = async (margins: {\r\n  top?: number;\r\n  bottom?: number;\r\n  left?: number;\r\n  right?: number;\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const sections = context.document.sections;\r\n    sections.load('items');\r\n    await context.sync();\r\n\r\n    sections.items.forEach((section) => {\r\n      const pageSetup = section.pageSetup;\r\n      if (margins.top !== undefined) pageSetup.topMargin = margins.top;\r\n      if (margins.bottom !== undefined) pageSetup.bottomMargin = margins.bottom;\r\n      if (margins.left !== undefined) pageSetup.leftMargin = margins.left;\r\n      if (margins.right !== undefined) pageSetup.rightMargin = margins.right;\r\n    });\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Fix all headings in the document\r\n */\r\n/**\r\n * Fix all headings in the document\r\n * Detects headings by size, bold, or keywords and applies standard Word styles\r\n */\r\nexport const fixAllHeadings = async (): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const paragraphs = context.document.body.paragraphs;\r\n    paragraphs.load('items, style, text, font');\r\n    await context.sync();\r\n\r\n    const headingKeywords = ['introduction', 'conclusion', 'abstract', 'references', 'chapter', 'section', 'summary', 'background', 'methodology', 'results', 'discussion'];\r\n\r\n    paragraphs.items.forEach((paragraph) => {\r\n      const text = paragraph.text.trim();\r\n      const lowerText = text.toLowerCase();\r\n      const wordCount = text.split(/\\s+/).length;\r\n      const charCount = text.length;\r\n\r\n      if (charCount === 0) return;\r\n\r\n      // Detection Logic\r\n      let isHeading = false;\r\n      let targetStyle = '';\r\n\r\n      // 1. Keyword Detection (must be short)\r\n      if (charCount < 50 && headingKeywords.some(k => lowerText.includes(k))) {\r\n        isHeading = true;\r\n        targetStyle = 'Heading 1';\r\n      }\r\n      // 2. Visual Detection\r\n      else if (paragraph.font.size >= 14) {\r\n        isHeading = true;\r\n        if (paragraph.font.size >= 18) targetStyle = 'Heading 1';\r\n        else targetStyle = 'Heading 2';\r\n      }\r\n      else if (paragraph.font.bold && charCount < 100 && charCount > 3 && wordCount < 15) {\r\n        // Short bold text is likely a sub-heading\r\n        isHeading = true;\r\n        targetStyle = 'Heading 3';\r\n      }\r\n      // 3. Existing Heading Styles\r\n      else if (paragraph.style.includes('Heading')) {\r\n        isHeading = true;\r\n        targetStyle = paragraph.style; // Keep existing level but normalize format\r\n      }\r\n\r\n      // Application Logic\r\n      if (isHeading) {\r\n        // Apply Style\r\n        if (targetStyle && paragraph.style !== targetStyle) {\r\n          paragraph.style = targetStyle;\r\n        }\r\n\r\n        // Enforce Clean Formatting\r\n        paragraph.font.name = 'Calibri';\r\n        paragraph.font.color = 'Black'; // Standard black\r\n        paragraph.font.bold = true;\r\n        paragraph.font.italic = false;\r\n        paragraph.font.underline = Word.UnderlineType.none;\r\n        paragraph.alignment = Word.Alignment.left;\r\n\r\n        // Enforce Sizes based on level\r\n        if (paragraph.style === 'Heading 1') {\r\n          paragraph.font.size = 16;\r\n        } else if (paragraph.style === 'Heading 2') {\r\n          paragraph.font.size = 14;\r\n        } else if (paragraph.style === 'Heading 3') {\r\n          paragraph.font.size = 12;\r\n        }\r\n      }\r\n    });\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Normalize font styles across entire document\r\n */\r\n/**\r\n * Normalize font styles across entire document\r\n * Excludes Headings, Code blocks, and other special styles\r\n */\r\nexport const normalizeDocumentFonts = async (fontName: string = 'Calibri', fontSize: number = 12): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const paragraphs = context.document.body.paragraphs;\r\n    paragraphs.load('items, style, font');\r\n    await context.sync();\r\n\r\n    paragraphs.items.forEach((paragraph) => {\r\n      const style = paragraph.style;\r\n\r\n      // Exclusion Logic\r\n      // 1. Headings\r\n      if (style.includes('Heading')) return;\r\n\r\n      // 2. Code Blocks (often named \"Code\", \"Macro Text\", \"Consolas\")\r\n      if (style.includes('Code') || style.includes('Macro') || paragraph.font.name === 'Courier New' || paragraph.font.name === 'Consolas') return;\r\n\r\n      // 3. Quotes/Titles/Subtitles\r\n      if (style.includes('Quote') || style.includes('Title') || style.includes('Subtitle')) return;\r\n\r\n      // Apply Normalization\r\n      paragraph.font.name = fontName;\r\n      paragraph.font.size = fontSize;\r\n\r\n      // Note: We deliberately do NOT reset bold/italic to preserve emphasis in body text\r\n    });\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Update all footers with left and right text\r\n */\r\n/**\r\n * Update all footers with left, center, and right text\r\n */\r\nexport const updateAllFooters = async (leftText: string, centerText: string, rightText: string, addPageNumbers: boolean): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const sections = context.document.sections;\r\n    sections.load('items');\r\n    await context.sync();\r\n\r\n    for (const section of sections.items) {\r\n      const footer = section.getFooter(Word.HeaderFooterType.primary);\r\n      footer.clear();\r\n\r\n      // Insert a 1x3 table for layout (Left, Center, Right)\r\n      const table = footer.insertTable(1, 3, Word.InsertLocation.start);\r\n      table.styleBuiltIn = Word.BuiltInStyleName.tableGrid;\r\n      table.headerRowCount = 0;\r\n\r\n      // Remove borders\r\n      const border = table.getBorder(Word.BorderLocation.all);\r\n      border.type = Word.BorderType.none;\r\n\r\n      // Get cells\r\n      const rangeLeft = table.getCell(0, 0).body;\r\n      const rangeCenter = table.getCell(0, 1).body;\r\n      const rangeRight = table.getCell(0, 2).body;\r\n\r\n      // Insert text\r\n      if (leftText) {\r\n        rangeLeft.insertText(leftText, Word.InsertLocation.replace);\r\n        rangeLeft.paragraphs.getFirst().alignment = Word.Alignment.left;\r\n      }\r\n\r\n      if (addPageNumbers) {\r\n        // Insert Page Number in Center (overrides text if both present, or we can append)\r\n        // Usually page numbers are standalone in a section\r\n        // We use the range to insert fields\r\n        const range = rangeCenter.getRange(Word.RangeLocation.content);\r\n        range.insertText(\"Page \", Word.InsertLocation.start);\r\n        range.insertField(Word.InsertLocation.end, Word.FieldType.page);\r\n        range.insertText(\" of \", Word.InsertLocation.end);\r\n        range.insertField(Word.InsertLocation.end, Word.FieldType.numPages);\r\n        rangeCenter.paragraphs.getFirst().alignment = Word.Alignment.centered;\r\n      } else if (centerText) {\r\n        rangeCenter.insertText(centerText, Word.InsertLocation.replace);\r\n        rangeCenter.paragraphs.getFirst().alignment = Word.Alignment.centered;\r\n      }\r\n\r\n      if (rightText) {\r\n        rangeRight.insertText(rightText, Word.InsertLocation.replace);\r\n        rangeRight.paragraphs.getFirst().alignment = Word.Alignment.right;\r\n      }\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Update all headers with left and right text\r\n */\r\nexport const updateAllHeaders = async (leftText: string, rightText: string): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const sections = context.document.sections;\r\n    sections.load('items');\r\n    await context.sync();\r\n\r\n    for (const section of sections.items) {\r\n      const header = section.getHeader(Word.HeaderFooterType.primary);\r\n      header.clear();\r\n\r\n      // Insert a 1x2 table for layout\r\n      const table = header.insertTable(1, 2, Word.InsertLocation.start);\r\n      table.styleBuiltIn = Word.BuiltInStyleName.tableGrid;\r\n      table.headerRowCount = 0;\r\n\r\n      // Remove borders\r\n      const border = table.getBorder(Word.BorderLocation.all);\r\n      border.type = Word.BorderType.none;\r\n\r\n      // Get cells\r\n      const rangeLeft = table.getCell(0, 0).body;\r\n      const rangeRight = table.getCell(0, 1).body;\r\n\r\n      // Insert text\r\n      if (leftText) {\r\n        rangeLeft.insertText(leftText, Word.InsertLocation.replace);\r\n        rangeLeft.paragraphs.getFirst().alignment = Word.Alignment.left;\r\n      }\r\n\r\n      if (rightText) {\r\n        rangeRight.insertText(rightText, Word.InsertLocation.replace);\r\n        rangeRight.paragraphs.getFirst().alignment = Word.Alignment.right;\r\n      }\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Apply bullet list to selection\r\n */\r\nexport const applyBulletList = async (): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    const paragraphs = range.paragraphs;\r\n    paragraphs.load('items');\r\n    await context.sync();\r\n\r\n    paragraphs.items.forEach((paragraph) => {\r\n      paragraph.startNewList();\r\n      const listItem = paragraph.listItemOrNullObject;\r\n      listItem.load('level');\r\n      listItem.level = 0;\r\n    });\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Apply numbered list to selection\r\n */\r\nexport const applyNumberedList = async (): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    const paragraphs = range.paragraphs;\r\n    paragraphs.load('items');\r\n    await context.sync();\r\n\r\n    // Use built-in numbering template\r\n    const firstParagraph = paragraphs.getFirst();\r\n    firstParagraph.startNewList();\r\n\r\n    for (let i = 1; i < paragraphs.items.length; i++) {\r\n      paragraphs.items[i].attachToList(firstParagraph.list.id, 0);\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Center all images in the document\r\n */\r\nexport const centerAllImages = async (padding: number = 0, addCaptions: boolean = false, alignment: 'left' | 'centered' | 'right' = 'centered'): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    // 1. Convert Floating Images to Inline (Batch 1)\r\n    try {\r\n      const shapes = context.document.body.shapes;\r\n      shapes.load('items');\r\n      await context.sync();\r\n\r\n      // Iterate backwards to safely modify the collection\r\n      for (let i = shapes.items.length - 1; i >= 0; i--) {\r\n        const shape = shapes.items[i];\r\n        shape.load('type');\r\n      }\r\n      await context.sync();\r\n\r\n      for (let i = shapes.items.length - 1; i >= 0; i--) {\r\n        const shape = shapes.items[i];\r\n        if (shape.type === Word.ShapeType.picture) {\r\n          (shape as any).convertToInlinePicture();\r\n        }\r\n      }\r\n      await context.sync();\r\n    } catch (error) {\r\n      console.warn('Error converting shapes:', error);\r\n    }\r\n\r\n    // 2. Load Inline Images and Context (Batch 2)\r\n    const images = context.document.body.inlinePictures;\r\n    images.load('items');\r\n    await context.sync();\r\n\r\n    // Pre-load next paragraphs for caption checking\r\n    const nextParagraphs: Word.Paragraph[] = [];\r\n    if (addCaptions) {\r\n      for (const image of images.items) {\r\n        const nextPara = image.paragraph.getNextOrNullObject();\r\n        nextPara.load('text');\r\n        nextParagraphs.push(nextPara);\r\n      }\r\n      // Sync to get the texts\r\n      await context.sync();\r\n    }\r\n\r\n    // 3. Apply Formatting and Insert Captions (Batch 3)\r\n    let captionIndex = 1;\r\n\r\n    for (let i = 0; i < images.items.length; i++) {\r\n      const image = images.items[i];\r\n      const paragraph = image.paragraph;\r\n\r\n      // Apply Alignment & Padding\r\n      if (alignment === 'left') paragraph.alignment = Word.Alignment.left;\r\n      else if (alignment === 'right') paragraph.alignment = Word.Alignment.right;\r\n      else paragraph.alignment = Word.Alignment.centered;\r\n\r\n      paragraph.spaceBefore = padding;\r\n      paragraph.spaceAfter = padding;\r\n\r\n      // Apply Captions\r\n      if (addCaptions) {\r\n        // Safety check for nextParagraphs array\r\n        if (i < nextParagraphs.length) {\r\n          const nextPara = nextParagraphs[i];\r\n          let isCaptioned = false;\r\n\r\n          if (!nextPara.isNullObject) {\r\n            const text = nextPara.text.trim();\r\n            if (text.startsWith('Figure') && text.length < 100) {\r\n              isCaptioned = true;\r\n            }\r\n          }\r\n\r\n          if (!isCaptioned) {\r\n            const captionText = `Figure ${captionIndex}: `;\r\n            const captionParagraph = paragraph.insertParagraph(captionText, Word.InsertLocation.after);\r\n\r\n            // Format Caption\r\n            if (alignment === 'left') captionParagraph.alignment = Word.Alignment.left;\r\n            else if (alignment === 'right') captionParagraph.alignment = Word.Alignment.right;\r\n            else captionParagraph.alignment = Word.Alignment.centered;\r\n\r\n            captionParagraph.font.italic = true;\r\n            captionParagraph.font.size = 10;\r\n            captionParagraph.font.name = 'Calibri';\r\n            captionParagraph.spaceBefore = 0;\r\n            captionParagraph.spaceAfter = 12;\r\n          }\r\n        }\r\n        captionIndex++;\r\n      }\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Set text wrapping for all images\r\n */\r\nexport const wrapAllImages = async (): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const images = context.document.body.inlinePictures;\r\n    images.load('items');\r\n    await context.sync();\r\n\r\n    // Note: Advanced image wrapping requires floating pictures\r\n    // This sets basic inline picture alignment\r\n    images.items.forEach((image) => {\r\n      const paragraph = image.paragraph;\r\n      paragraph.alignment = Word.Alignment.left;\r\n    });\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Auto-format entire document with standard settings\r\n */\r\nexport const autoFormatDocument = async (): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    // Set standard margins (1 inch = 72 points)\r\n    await setDocumentMargins({\r\n      top: 72,\r\n      bottom: 72,\r\n      left: 72,\r\n      right: 72,\r\n    });\r\n\r\n    // Normalize fonts\r\n    await normalizeDocumentFonts('Calibri', 11);\r\n\r\n    // Fix headings\r\n    await fixAllHeadings();\r\n\r\n    // Center images\r\n    await centerAllImages();\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Insert text with specific formatting\r\n */\r\nexport const insertFormattedText = async (\r\n  text: string,\r\n  formatting: {\r\n    fontName?: string;\r\n    fontSize?: number;\r\n    bold?: boolean;\r\n    italic?: boolean;\r\n    color?: string;\r\n  }\r\n): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    const insertedRange = range.insertText(text, Word.InsertLocation.end);\r\n\r\n    if (formatting.fontName) insertedRange.font.name = formatting.fontName;\r\n    if (formatting.fontSize) insertedRange.font.size = formatting.fontSize;\r\n    if (formatting.bold !== undefined) insertedRange.font.bold = formatting.bold;\r\n    if (formatting.italic !== undefined) insertedRange.font.italic = formatting.italic;\r\n    if (formatting.color) insertedRange.font.color = formatting.color;\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Clear all formatting from selection\r\n */\r\nexport const clearFormatting = async (): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    range.font.reset();\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Get document statistics\r\n */\r\nexport const getDocumentStats = async (): Promise<{\r\n  characterCount: number;\r\n  wordCount: number;\r\n  paragraphCount: number;\r\n}> => {\r\n  return await Word.run(async (context) => {\r\n    const body = context.document.body;\r\n    body.load('text');\r\n\r\n    const paragraphs = body.paragraphs;\r\n    paragraphs.load('items');\r\n\r\n    await context.sync();\r\n\r\n    const text = body.text;\r\n    const wordCount = text.split(/\\s+/).filter(word => word.length > 0).length;\r\n    const characterCount = text.length;\r\n    const paragraphCount = paragraphs.items.length;\r\n\r\n    return {\r\n      characterCount,\r\n      wordCount,\r\n      paragraphCount,\r\n    };\r\n  });\r\n};\r\n\r\n/**\r\n * Get the full document text\r\n */\r\nexport const getFullDocumentText = async (): Promise<string> => {\r\n  return await Word.run(async (context) => {\r\n    const body = context.document.body;\r\n    body.load('text');\r\n    await context.sync();\r\n    return body.text;\r\n  });\r\n};\r\n\r\n/**\r\n * Format the current selection with specific styles\r\n */\r\nexport const formatSelection = async (formatting: {\r\n  bold?: boolean;\r\n  italic?: boolean;\r\n  underline?: boolean;\r\n  fontName?: string;\r\n  fontSize?: number;\r\n  color?: string;\r\n  alignment?: 'left' | 'center' | 'right' | 'justify';\r\n  lineSpacing?: number;\r\n  spaceAfter?: number;\r\n  spaceBefore?: number;\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n\r\n    if (formatting.fontName) range.font.name = formatting.fontName;\r\n    if (formatting.fontSize) range.font.size = formatting.fontSize;\r\n    if (formatting.bold !== undefined) range.font.bold = formatting.bold;\r\n    if (formatting.italic !== undefined) range.font.italic = formatting.italic;\r\n    if (formatting.underline !== undefined) {\r\n      range.font.underline = formatting.underline ? Word.UnderlineType.single : Word.UnderlineType.none;\r\n    }\r\n    if (formatting.color) range.font.color = formatting.color;\r\n\r\n    if (formatting.alignment || formatting.lineSpacing || formatting.spaceAfter !== undefined || formatting.spaceBefore !== undefined) {\r\n      const paragraphs = range.paragraphs;\r\n      paragraphs.load('items');\r\n      await context.sync();\r\n\r\n      paragraphs.items.forEach(p => {\r\n        if (formatting.alignment) {\r\n          p.alignment = formatting.alignment as Word.Alignment;\r\n        }\r\n        if (formatting.lineSpacing) {\r\n          p.lineSpacing = formatting.lineSpacing;\r\n        }\r\n        if (formatting.spaceAfter !== undefined) {\r\n          p.spaceAfter = formatting.spaceAfter;\r\n        }\r\n        if (formatting.spaceBefore !== undefined) {\r\n          p.spaceBefore = formatting.spaceBefore;\r\n        }\r\n      });\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Format the entire document with specific styles\r\n */\r\nexport const formatDocument = async (formatting: {\r\n  bold?: boolean;\r\n  italic?: boolean;\r\n  underline?: boolean;\r\n  fontName?: string;\r\n  fontSize?: number;\r\n  color?: string;\r\n  alignment?: 'left' | 'center' | 'right' | 'justify';\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const body = context.document.body;\r\n\r\n    if (formatting.fontName) body.font.name = formatting.fontName;\r\n    if (formatting.fontSize) body.font.size = formatting.fontSize;\r\n    if (formatting.bold !== undefined) body.font.bold = formatting.bold;\r\n    if (formatting.italic !== undefined) body.font.italic = formatting.italic;\r\n    if (formatting.underline !== undefined) {\r\n      body.font.underline = formatting.underline ? Word.UnderlineType.single : Word.UnderlineType.none;\r\n    }\r\n    if (formatting.color) body.font.color = formatting.color;\r\n\r\n    if (formatting.alignment) {\r\n      const paragraphs = body.paragraphs;\r\n      paragraphs.load('items');\r\n      await context.sync();\r\n\r\n      paragraphs.items.forEach(p => {\r\n        p.alignment = formatting.alignment as Word.Alignment;\r\n      });\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Add border to the current selection using HTML table\r\n */\r\nexport const addBorderToSelection = async (options?: {\r\n  style?: string;\r\n  color?: string;\r\n  width?: number;\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    range.load('text');\r\n    await context.sync();\r\n\r\n    const originalText = range.text;\r\n    const borderStyle = options?.style || 'solid';\r\n    const borderColor = options?.color || '#000000';\r\n    const borderWidth = options?.width || 1;\r\n\r\n    // Insert HTML table with border for better control\r\n    const htmlContent = `\r\n      <table style=\"border-collapse: collapse; width: 100%;\">\r\n        <tr>\r\n          <td style=\"border: ${borderWidth}pt ${borderStyle} ${borderColor}; padding: 10pt;\">\r\n            ${originalText.replace(/\\n/g, '<br>')}\r\n          </td>\r\n        </tr>\r\n      </table>\r\n    `;\r\n\r\n    range.insertHtml(htmlContent, Word.InsertLocation.replace);\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Add page border to all pages\r\n */\r\nexport const addPageBorder = async (options?: {\r\n  style?: string;\r\n  color?: string;\r\n  width?: number;\r\n  applyToAllPages?: boolean;\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const sections = context.document.sections;\r\n    sections.load('items');\r\n    await context.sync();\r\n\r\n    const borderStyle = options?.style || 'solid';\r\n    const borderColor = options?.color || '#000000';\r\n    const borderWidth = options?.width || 6;\r\n\r\n    // Apply border to each section using tables\r\n    for (const section of sections.items) {\r\n      const body = section.body;\r\n      body.load('text');\r\n      await context.sync();\r\n\r\n      const content = body.text;\r\n\r\n      // Insert a bordered table at the start of the section\r\n      const htmlBorder = `\r\n        <table style=\"border-collapse: collapse; width: 100%; height: 100%;\">\r\n          <tr>\r\n            <td style=\"border: ${borderWidth}pt ${borderStyle} ${borderColor}; padding: 30pt;\">\r\n              ${content.replace(/\\n/g, '<br>')}\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      `;\r\n\r\n      body.insertHtml(htmlBorder, Word.InsertLocation.replace);\r\n    }\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Add border to paragraphs using HTML tables\r\n */\r\nexport const addBorderToParagraphs = async (options?: {\r\n  style?: string;\r\n  color?: string;\r\n  width?: number;\r\n  target?: 'selection' | 'document';\r\n  borderPosition?: 'top' | 'bottom' | 'all';\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    let range;\r\n    if (options?.target === 'document') {\r\n      range = context.document.body.getRange();\r\n    } else {\r\n      range = context.document.getSelection();\r\n    }\r\n\r\n    range.load('text');\r\n    await context.sync();\r\n\r\n    const borderStyle = options?.style || 'solid';\r\n    const borderColor = options?.color || '#000000';\r\n    const borderWidth = options?.width || 1;\r\n    const position = options?.borderPosition || 'all';\r\n\r\n    let borderCss = '';\r\n    if (position === 'all') {\r\n      borderCss = `border: ${borderWidth}pt ${borderStyle} ${borderColor};`;\r\n    } else if (position === 'top') {\r\n      borderCss = `border-top: ${borderWidth}pt ${borderStyle} ${borderColor};`;\r\n    } else if (position === 'bottom') {\r\n      borderCss = `border-bottom: ${borderWidth}pt ${borderStyle} ${borderColor};`;\r\n    }\r\n\r\n    const content = range.text;\r\n    const htmlContent = `\r\n      <div style=\"${borderCss} padding: 10pt;\">\r\n        ${content.replace(/\\n/g, '<br>')}\r\n      </div>\r\n    `;\r\n\r\n    range.insertHtml(htmlContent, Word.InsertLocation.replace);\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Remove borders from selection or document (removes table wrappers)\r\n */\r\nexport const removeBorders = async (target?: 'selection' | 'document'): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    let tables;\r\n    if (target === 'document') {\r\n      tables = context.document.body.tables;\r\n    } else {\r\n      const range = context.document.getSelection();\r\n      tables = range.tables;\r\n    }\r\n\r\n    tables.load('items');\r\n    await context.sync();\r\n\r\n    // Remove borders from all tables\r\n    tables.items.forEach((table) => {\r\n      const borders = [\r\n        table.getBorder(Word.BorderLocation.top),\r\n        table.getBorder(Word.BorderLocation.bottom),\r\n        table.getBorder(Word.BorderLocation.left),\r\n        table.getBorder(Word.BorderLocation.right),\r\n        table.getBorder(Word.BorderLocation.insideHorizontal),\r\n        table.getBorder(Word.BorderLocation.insideVertical),\r\n      ];\r\n\r\n      borders.forEach((border) => {\r\n        border.type = Word.BorderType.none;\r\n      });\r\n    });\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n\r\n/**\r\n * Add decorative border with custom styling (box effect)\r\n */\r\nexport const addDecorativeBorder = async (options?: {\r\n  style?: string;\r\n  color?: string;\r\n  width?: number;\r\n  padding?: number;\r\n  shading?: string;\r\n}): Promise<void> => {\r\n  await Word.run(async (context) => {\r\n    const range = context.document.getSelection();\r\n    range.load('text');\r\n    await context.sync();\r\n\r\n    const borderStyle = options?.style || 'double';\r\n    const borderColor = options?.color || '#0078D4';\r\n    const borderWidth = options?.width || 4;\r\n    const padding = options?.padding || 15;\r\n    const backgroundColor = options?.shading || 'transparent';\r\n\r\n    const originalText = range.text;\r\n\r\n    // Create decorative bordered box using HTML\r\n    const htmlContent = `\r\n      <table style=\"border-collapse: collapse; width: 100%;\">\r\n        <tr>\r\n          <td style=\"border: ${borderWidth}pt ${borderStyle} ${borderColor}; padding: ${padding}pt; background-color: ${backgroundColor};\">\r\n            ${originalText.replace(/\\n/g, '<br>')}\r\n          </td>\r\n        </tr>\r\n      </table>\r\n    `;\r\n\r\n    range.insertHtml(htmlContent, Word.InsertLocation.replace);\r\n\r\n    await context.sync();\r\n  });\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"D:\\Desktop\\Files\\JV-ForMate\\Add-in-TWO\\vite.config.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'__dirname' is assigned a value but never used.","line":8,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { defineConfig, loadEnv } from 'vite';\r\nimport react from '@vitejs/plugin-react';\r\nimport fs from \"node:fs\";\r\nimport path from \"node:path\";\r\nimport { fileURLToPath } from \"node:url\";\r\nimport os from \"node:os\";\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\n\r\nexport default defineConfig(({ mode }) => {\r\n  // Load env file based on `mode` in the current working directory.\r\n  const env = loadEnv(mode, process.cwd(), '');\r\n  \r\n  const homeDir = os.homedir();\r\n  const certPath = path.resolve(homeDir, \".office-addin-dev-certs\", \"localhost.crt\");\r\n  const keyPath = path.resolve(homeDir, \".office-addin-dev-certs\", \"localhost.key\");\r\n\r\n  return {\r\n    plugins: [react()],\r\n    server: {\r\n      https: {\r\n        key: fs.readFileSync(keyPath),\r\n        cert: fs.readFileSync(certPath),\r\n      },\r\n      port: 3000,\r\n    },\r\n    build: {\r\n      outDir: 'dist',\r\n      rollupOptions: {\r\n        input: {\r\n          taskpane: './src/taskpane/taskpane.html',\r\n          commands: './src/commands/commands.html',\r\n          'oauth-callback': './public/oauth-callback.html',\r\n        },\r\n      },\r\n    },\r\n    define: {\r\n      // Make env variables available to the app\r\n      'import.meta.env.VITE_GOOGLE_CLIENT_ID': JSON.stringify(env.VITE_GOOGLE_CLIENT_ID),\r\n      'import.meta.env.VITE_GEMINI_API_KEY': JSON.stringify(env.VITE_GEMINI_API_KEY),\r\n      'import.meta.env.VITE_DEV_SERVER_URL': JSON.stringify(env.VITE_DEV_SERVER_URL),\r\n    },\r\n  };\r\n});\r\n\r\n\r\n\r\n\r\n\r\n// import { defineConfig, loadEnv } from 'vite';\r\n// import react from '@vitejs/plugin-react';\r\n// import fs from 'node:fs';\r\n// import path from 'node:path';\r\n// import { fileURLToPath } from 'node:url';\r\n\r\n// const __dirname = path.dirname(fileURLToPath(import.meta.url));\r\n\r\n// export default defineConfig(({ mode }) => {\r\n//   // Load env file based on `mode` in the current working directory.\r\n//   const env = loadEnv(mode, process.cwd(), '');\r\n\r\n//   return {\r\n//     plugins: [react()],\r\n//     server: {\r\n//       https: {\r\n//         // mkcert output files (run: mkcert localhost 127.0.0.1 ::1)\r\n//         key: fs.readFileSync(path.resolve(__dirname, 'localhost+2-key.pem')),\r\n//         cert: fs.readFileSync(path.resolve(__dirname, 'localhost+2.pem')),\r\n//       },\r\n//       port: 3000,\r\n//     },\r\n//     build: {\r\n//       outDir: 'dist',\r\n//       rollupOptions: {\r\n//         input: {\r\n//           taskpane: './src/taskpane/taskpane.html',\r\n//           commands: './src/commands/commands.html',\r\n//           'oauth-callback': './public/oauth-callback.html',\r\n//         },\r\n//       },\r\n//     },\r\n//     define: {\r\n//       // Make env variables available to the app\r\n//       'import.meta.env.VITE_GOOGLE_CLIENT_ID': JSON.stringify(env.VITE_GOOGLE_CLIENT_ID),\r\n//       'import.meta.env.VITE_GEMINI_API_KEY': JSON.stringify(env.VITE_GEMINI_API_KEY),\r\n//       'import.meta.env.VITE_DEV_SERVER_URL': JSON.stringify(env.VITE_DEV_SERVER_URL),\r\n//     },\r\n//   };\r\n// });\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]